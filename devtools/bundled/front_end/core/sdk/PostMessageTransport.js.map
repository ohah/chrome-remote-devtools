{"version":3,"file":"PostMessageTransport.js","sourceRoot":"","sources":["../../../../../../front_end/core/sdk/PostMessageTransport.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/**\n * PostMessageTransport implements CDP protocol communication via postMessage API / PostMessageTransport는 postMessage API를 통해 CDP 프로토콜 통신을 구현합니다.\n *\n * This transport allows DevTools to communicate with parent window (iframe) or opener window (popup) / 이 transport는 DevTools가 부모 창(iframe) 또는 열린 창(popup)과 통신할 수 있게 합니다.\n * without requiring a WebSocket connection / WebSocket 연결 없이.\n */\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../platform/platform.js';\nimport * as ProtocolClient from '../protocol_client/protocol_client.js';\n\nconst UIStrings = {\n  /**\n   * @description Text to indicate postMessage connection cannot find host window / postMessage 연결이 호스트 창을 찾을 수 없음을 나타내는 텍스트\n   */\n  noHostWindow: 'Can not find host window',\n};\nconst str_ = i18n.i18n.registerUIStrings('core/sdk/PostMessageTransport.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n/**\n * PostMessageTransport implements ConnectionTransport using postMessage API / PostMessageTransport는 postMessage API를 사용하여 ConnectionTransport를 구현합니다.\n *\n * This transport is used when DevTools is loaded in an iframe or popup window / 이 transport는 DevTools가 iframe 또는 팝업 창에 로드될 때 사용됩니다.\n * and needs to communicate with the parent/opener window via postMessage / 부모/열린 창과 postMessage를 통해 통신해야 할 때.\n */\nexport class PostMessageTransport implements ProtocolClient.ConnectionTransport.ConnectionTransport {\n  onMessage: ((arg0: Object|string) => void)|null = null;\n  #onDisconnect: ((arg0: string) => void)|null = null;\n  #targetWindow: Window|null = null;\n  #messageHandler = this.#onMessageReceived.bind(this);\n  #ready = false;\n\n  constructor(onConnectionLost: (message: Platform.UIString.LocalizedString) => void) {\n    // Determine target window (parent for iframe, opener for popup) / 대상 창 결정 (iframe은 parent, 팝업은 opener)\n    if (window.opener) {\n      this.#targetWindow = window.opener;\n    } else if (window !== window.top) {\n      this.#targetWindow = window.parent;\n    } else {\n      onConnectionLost(i18nString(UIStrings.noHostWindow));\n      return;\n    }\n    // Listen for CDP messages from parent/opener / parent/opener로부터 CDP 메시지 수신\n    window.addEventListener('message', this.#messageHandler);\n    // Notify parent/opener that we're ready / parent/opener에 준비 완료 알림\n    if (this.#targetWindow) {\n      const readyMessage = {type: 'DEVTOOLS_READY'};\n      this.#targetWindow.postMessage(readyMessage, '*');\n      this.#ready = true;\n    }\n  }\n\n  /**\n   * Handle incoming postMessage events / 들어오는 postMessage 이벤트 처리\n   */\n  #onMessageReceived(event: MessageEvent): void {\n    // Only accept messages from target window / 대상 창으로부터의 메시지만 수락\n    if (event.source !== this.#targetWindow) {\n      return;\n    }\n    // Handle CDP protocol messages / CDP 프로토콜 메시지 처리\n    if (event.data && typeof event.data === 'object' && event.data.type === 'CDP_MESSAGE') {\n      if (this.onMessage) {\n        this.onMessage.call(null, event.data.message);\n      }\n    }\n  }\n\n  setOnMessage(onMessage: (arg0: Object|string) => void): void {\n    this.onMessage = onMessage;\n  }\n\n  setOnDisconnect(onDisconnect: (arg0: string) => void): void {\n    this.#onDisconnect = onDisconnect;\n  }\n\n  /**\n   * Send CDP message to parent/opener window / 부모/열린 창에 CDP 메시지 전송\n   */\n  sendRawMessage(message: string): void {\n    if (this.#targetWindow && this.#ready) {\n      const cdpMessage = {type: 'CDP_MESSAGE', message};\n      this.#targetWindow.postMessage(cdpMessage, '*');\n    }\n  }\n\n  async disconnect(): Promise<void> {\n    window.removeEventListener('message', this.#messageHandler);\n    if (this.#onDisconnect) {\n      this.#onDisconnect.call(null, 'force disconnect');\n    }\n    this.#onDisconnect = null;\n    this.onMessage = null;\n    this.#targetWindow = null;\n    this.#ready = false;\n  }\n}\n"]}
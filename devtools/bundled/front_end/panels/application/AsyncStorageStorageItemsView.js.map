{"version":3,"file":"AsyncStorageStorageItemsView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/application/AsyncStorageStorageItemsView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\n/*\n * Copyright (C) 2008 Nokia Inc.  All rights reserved.\n * Copyright (C) 2013 Samsung Electronics. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * 1. Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as SourceFrame from '../../ui/legacy/components/source_frame/source_frame.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport * as ApplicationComponents from './components/components.js';\nimport {KeyValueStorageItemsView} from './KeyValueStorageItemsView.js';\nimport {AsyncStorageStorage} from './AsyncStorageStorageModel.js';\n\nconst UIStrings = {\n  /**\n   * @description Name for the \"AsyncStorage Storage Items\" table that shows the content of the AsyncStorage Storage.\n   */\n  asyncStorageStorageItems: 'AsyncStorage Storage Items',\n  /**\n   * @description Text for announcing that the \"AsyncStorage Storage Items\" table was cleared, that is, all\n   * entries were deleted.\n   */\n  asyncStorageStorageItemsCleared: 'AsyncStorage Storage Items cleared',\n  /**\n   * @description Text for announcing a AsyncStorage Storage key/value item has been deleted\n   */\n  asyncStorageStorageItemDeleted: 'The storage item was deleted.',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/application/AsyncStorageStorageItemsView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class AsyncStorageStorageItemsView extends KeyValueStorageItemsView {\n  private asyncStorageStorage: AsyncStorageStorage;\n  private eventListeners: Common.EventTarget.EventDescriptor[];\n\n  get storage(): AsyncStorageStorage {\n    return this.asyncStorageStorage;\n  }\n\n  constructor(asyncStorageStorage: AsyncStorageStorage) {\n    // Create custom metadata view that shows only instanceId / instanceId만 표시하는 커스텀 metadata view 생성\n    const metadataView = new ApplicationComponents.StorageMetadataView.StorageMetadataView();\n    // Override getTitle to return only instanceId / getTitle을 오버라이드하여 instanceId만 반환\n    metadataView.getTitle = () => asyncStorageStorage.instanceId;\n\n    super(i18nString(UIStrings.asyncStorageStorageItems), 'async-storage-storage', true, undefined, metadataView);\n\n    this.asyncStorageStorage = asyncStorageStorage;\n    this.element.classList.add('storage-view', 'table');\n\n    this.showPreview(null, null);\n\n    this.eventListeners = [];\n    this.setStorage(asyncStorageStorage);\n  }\n\n  protected createPreview(key: string, value: string): Promise<UI.Widget.Widget|null> {\n    const url = `async-storage://${this.asyncStorageStorage.instanceId}/${key}` as Platform.DevToolsPath.UrlString;\n    const provider = TextUtils.StaticContentProvider.StaticContentProvider.fromString(\n        url,\n        Common.ResourceType.resourceTypes.XHR,\n        value,\n    );\n    return SourceFrame.PreviewFactory.PreviewFactory.createPreview(\n        provider,\n        'text/plain',\n    );\n  }\n\n  setStorage(asyncStorageStorage: AsyncStorageStorage): void {\n    Common.EventTarget.removeEventListeners(this.eventListeners);\n    this.asyncStorageStorage = asyncStorageStorage;\n    this.element.setAttribute('jslog', `${VisualLogging.pane().context('async-storage-storage-data')}`);\n    this.eventListeners = [\n      this.asyncStorageStorage.addEventListener(AsyncStorageStorage.Events.ASYNC_STORAGE_ITEMS_CLEARED, this.asyncStorageStorageItemsCleared, this),\n      this.asyncStorageStorage.addEventListener(AsyncStorageStorage.Events.ASYNC_STORAGE_ITEM_REMOVED, this.asyncStorageStorageItemRemoved, this),\n      this.asyncStorageStorage.addEventListener(AsyncStorageStorage.Events.ASYNC_STORAGE_ITEM_ADDED, this.asyncStorageStorageItemAdded, this),\n      this.asyncStorageStorage.addEventListener(AsyncStorageStorage.Events.ASYNC_STORAGE_ITEM_UPDATED, this.asyncStorageStorageItemUpdated, this),\n    ];\n    this.refreshItems();\n  }\n\n  private asyncStorageStorageItemsCleared(): void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemsCleared();\n  }\n\n  override itemsCleared(): void {\n    super.itemsCleared();\n    UI.ARIAUtils.LiveAnnouncer.alert(i18nString(UIStrings.asyncStorageStorageItemsCleared));\n  }\n\n  private asyncStorageStorageItemRemoved(event: Common.EventTarget.EventTargetEvent<AsyncStorageStorage.AsyncStorageItemRemovedEvent>):\n      void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemRemoved(event.data.key);\n  }\n\n  override itemRemoved(key: string): void {\n    super.itemRemoved(key);\n    UI.ARIAUtils.LiveAnnouncer.alert(i18nString(UIStrings.asyncStorageStorageItemDeleted));\n  }\n\n  private asyncStorageStorageItemAdded(event: Common.EventTarget.EventTargetEvent<AsyncStorageStorage.AsyncStorageItemAddedEvent>): void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemAdded(event.data.key, event.data.value);\n  }\n\n  private asyncStorageStorageItemUpdated(event: Common.EventTarget.EventTargetEvent<AsyncStorageStorage.AsyncStorageItemUpdatedEvent>):\n      void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemUpdated(event.data.key, event.data.value);\n  }\n\n  override refreshItems(): void {\n    void this.#refreshItems();\n  }\n\n  async #refreshItems(): Promise<void> {\n    const items = await this.asyncStorageStorage.getItems();\n    if (!items || !this.toolbar) {\n      return;\n    }\n    const {filterRegex} = this.toolbar;\n    const filteredItems = items.map(item => ({key: item[0], value: item[1]}))\n                              .filter(item => filterRegex?.test(`${item.key} ${item.value}`) ?? true);\n    this.showItems(filteredItems);\n  }\n\n  override deleteAllItems(): void {\n    this.asyncStorageStorage.clear();\n    // explicitly clear the view because the event won't be fired when it has no items\n    this.asyncStorageStorageItemsCleared();\n  }\n\n  protected removeItem(key: string): void {\n    this.asyncStorageStorage?.removeItem(key);\n  }\n\n  protected setItem(key: string, value: string): void {\n    this.asyncStorageStorage?.setItem(key, value);\n  }\n}\n"]}
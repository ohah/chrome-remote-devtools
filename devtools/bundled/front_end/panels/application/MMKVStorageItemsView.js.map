{"version":3,"file":"MMKVStorageItemsView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/application/MMKVStorageItemsView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\n/*\n * Copyright (C) 2008 Nokia Inc.  All rights reserved.\n * Copyright (C) 2013 Samsung Electronics. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * 1. Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as SourceFrame from '../../ui/legacy/components/source_frame/source_frame.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport * as ApplicationComponents from './components/components.js';\nimport {KeyValueStorageItemsView} from './KeyValueStorageItemsView.js';\nimport {MMKVStorage} from './MMKVStorageModel.js';\n\nconst UIStrings = {\n  /**\n   * @description Name for the \"MMKV Storage Items\" table that shows the content of the MMKV Storage.\n   */\n  mmkvStorageItems: 'MMKV Storage Items',\n  /**\n   * @description Text for announcing that the \"MMKV Storage Items\" table was cleared, that is, all\n   * entries were deleted.\n   */\n  mmkvStorageItemsCleared: 'MMKV Storage Items cleared',\n  /**\n   * @description Text for announcing a MMKV Storage key/value item has been deleted\n   */\n  mmkvStorageItemDeleted: 'The storage item was deleted.',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/application/MMKVStorageItemsView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class MMKVStorageItemsView extends KeyValueStorageItemsView {\n  private mmkvStorage: MMKVStorage;\n  private eventListeners: Common.EventTarget.EventDescriptor[];\n\n  get storage(): MMKVStorage {\n    return this.mmkvStorage;\n  }\n\n  constructor(mmkvStorage: MMKVStorage) {\n    // Create custom metadata view that shows only instanceId / instanceId만 표시하는 커스텀 metadata view 생성\n    const metadataView = new ApplicationComponents.StorageMetadataView.StorageMetadataView();\n    // Override getTitle to return only instanceId / getTitle을 오버라이드하여 instanceId만 반환\n    metadataView.getTitle = () => mmkvStorage.instanceId;\n\n    super(i18nString(UIStrings.mmkvStorageItems), 'mmkv-storage', true, undefined, metadataView);\n\n    this.mmkvStorage = mmkvStorage;\n    this.element.classList.add('storage-view', 'table');\n\n    this.showPreview(null, null);\n\n    this.eventListeners = [];\n    this.setStorage(mmkvStorage);\n  }\n\n  protected createPreview(key: string, value: string): Promise<UI.Widget.Widget|null> {\n    const url = `mmkv://${this.mmkvStorage.instanceId}/${key}` as Platform.DevToolsPath.UrlString;\n    const provider = TextUtils.StaticContentProvider.StaticContentProvider.fromString(\n        url,\n        Common.ResourceType.resourceTypes.XHR,\n        value,\n    );\n    return SourceFrame.PreviewFactory.PreviewFactory.createPreview(\n        provider,\n        'text/plain',\n    );\n  }\n\n  setStorage(mmkvStorage: MMKVStorage): void {\n    Common.EventTarget.removeEventListeners(this.eventListeners);\n    this.mmkvStorage = mmkvStorage;\n    this.element.setAttribute('jslog', `${VisualLogging.pane().context('mmkv-storage-data')}`);\n    this.eventListeners = [\n      this.mmkvStorage.addEventListener(MMKVStorage.Events.MMKV_ITEMS_CLEARED, this.mmkvStorageItemsCleared, this),\n      this.mmkvStorage.addEventListener(MMKVStorage.Events.MMKV_ITEM_REMOVED, this.mmkvStorageItemRemoved, this),\n      this.mmkvStorage.addEventListener(MMKVStorage.Events.MMKV_ITEM_ADDED, this.mmkvStorageItemAdded, this),\n      this.mmkvStorage.addEventListener(MMKVStorage.Events.MMKV_ITEM_UPDATED, this.mmkvStorageItemUpdated, this),\n    ];\n    this.refreshItems();\n  }\n\n  private mmkvStorageItemsCleared(): void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemsCleared();\n  }\n\n  override itemsCleared(): void {\n    super.itemsCleared();\n    UI.ARIAUtils.LiveAnnouncer.alert(i18nString(UIStrings.mmkvStorageItemsCleared));\n  }\n\n  private mmkvStorageItemRemoved(event: Common.EventTarget.EventTargetEvent<MMKVStorage.MmkvItemRemovedEvent>):\n      void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemRemoved(event.data.key);\n  }\n\n  override itemRemoved(key: string): void {\n    super.itemRemoved(key);\n    UI.ARIAUtils.LiveAnnouncer.alert(i18nString(UIStrings.mmkvStorageItemDeleted));\n  }\n\n  private mmkvStorageItemAdded(event: Common.EventTarget.EventTargetEvent<MMKVStorage.MmkvItemAddedEvent>): void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemAdded(event.data.key, event.data.value);\n  }\n\n  private mmkvStorageItemUpdated(event: Common.EventTarget.EventTargetEvent<MMKVStorage.MmkvItemUpdatedEvent>):\n      void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemUpdated(event.data.key, event.data.value);\n  }\n\n  override refreshItems(): void {\n    void this.#refreshItems();\n  }\n\n  async #refreshItems(): Promise<void> {\n    const items = await this.mmkvStorage.getItems();\n    if (!items || !this.toolbar) {\n      return;\n    }\n    const {filterRegex} = this.toolbar;\n    const filteredItems = items.map(item => ({key: item[0], value: item[1]}))\n                              .filter(item => filterRegex?.test(`${item.key} ${item.value}`) ?? true);\n    this.showItems(filteredItems);\n  }\n\n  override deleteAllItems(): void {\n    this.mmkvStorage.clear();\n    // explicitly clear the view because the event won't be fired when it has no items\n    this.mmkvStorageItemsCleared();\n  }\n\n  protected removeItem(key: string): void {\n    this.mmkvStorage?.removeItem(key);\n  }\n\n  protected setItem(key: string, value: string): void {\n    this.mmkvStorage?.setItem(key, value);\n  }\n}\n"]}
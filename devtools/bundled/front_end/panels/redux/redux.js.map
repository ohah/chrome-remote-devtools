{
  "version": 3,
  "sources": ["../../../../../../front_end/panels/redux/ReduxPanel.ts", "../../../../../../front_end/panels/redux/ReduxExtensionBridge.ts"],
  "sourcesContent": ["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as ProtocolClient from '../../core/protocol_client/protocol_client.js';\nimport * as Root from '../../core/root/root.js';\nimport { ReduxExtensionBridge } from './ReduxExtensionBridge.js';\n\nexport class ReduxPanel extends UI.Panel.Panel {\n  #iframe: HTMLIFrameElement | null = null;\n  #bridge: ReduxExtensionBridge;\n  #target: SDK.Target.Target | null = null;\n\n  constructor() {\n    super('redux');\n    this.setHideOnDetach();\n\n    this.#bridge = new ReduxExtensionBridge();\n\n    // Create iframe directly / iframe 직접 생성\n    this.#iframe = document.createElement('iframe');\n    this.#iframe.className = 'redux-devtools-iframe';\n    this.#iframe.style.width = '100%';\n    this.#iframe.style.height = '100%';\n    this.#iframe.style.border = 'none';\n\n    // Build URL for devpanel.html / devpanel.html URL 구성\n    // Use the same base URL as the current page / 현재 페이지와 동일한 base URL 사용\n    const remoteBase = Root.Runtime.getRemoteBase();\n    let reduxDevToolsPage: Platform.DevToolsPath.UrlString;\n    if (remoteBase) {\n      // Use remote base if available / remote base가 있으면 사용\n      reduxDevToolsPage = `${remoteBase.base}panels/redux/extension/devpanel.html` as Platform.DevToolsPath.UrlString;\n    } else {\n      // Fallback to relative path / 상대 경로로 폴백\n      const currentPath = window.location.pathname;\n      const basePath = currentPath.substring(0, currentPath.lastIndexOf('/'));\n      reduxDevToolsPage = `${basePath}/panels/redux/extension/devpanel.html` as Platform.DevToolsPath.UrlString;\n    }\n    this.#iframe.src = reduxDevToolsPage;\n\n    this.#iframe.onload = () => {\n      if (this.#iframe?.contentWindow) {\n        this.#bridge.initialize(this.#iframe.contentWindow);\n      }\n    };\n\n    this.contentElement.appendChild(this.#iframe);\n\n    // Setup CDP listener / CDP 리스너 설정\n    this.setupCDPListener();\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.setupCDPListener();\n  }\n\n  override willHide(): void {\n    super.willHide();\n    this.cleanupCDPListener();\n  }\n\n\n  private setupCDPListener(): void {\n    const target = SDK.TargetManager.TargetManager.instance().primaryPageTarget();\n    if (!target) {\n      SDK.TargetManager.TargetManager.instance().addEventListener(\n        SDK.TargetManager.Events.AVAILABLE_TARGETS_CHANGED,\n        () => {\n          const newTarget = SDK.TargetManager.TargetManager.instance().primaryPageTarget();\n          if (newTarget && !this.#target) {\n            this.#target = newTarget;\n            this.attachToTarget(newTarget);\n          }\n        },\n        this\n      );\n      return;\n    }\n\n    this.#target = target;\n    this.attachToTarget(target);\n  }\n\n  private attachToTarget(target: SDK.Target.Target): void {\n    const router = target.router();\n    if (!router?.connection) {\n      return;\n    }\n\n    // Redux CDP 이벤트를 bridge로 전달 / Redux CDP 이벤트를 bridge로 전달\n    this.#bridge.attachToTarget(target, router.connection);\n  }\n\n  private cleanupCDPListener(): void {\n    this.#bridge.cleanup();\n  }\n}\n\n\n", "// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as ProtocolClient from '../../core/protocol_client/protocol_client.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\n/**\n * Redux DevTools Extension과의 통신 브릿지 / Redux DevTools Extension과의 통신 브릿지\n * Extension의 chrome.runtime API를 시뮬레이션하고 CDP 메시지를 Extension 형식으로 변환 / Extension의 chrome.runtime API를 시뮬레이션하고 CDP 메시지를 Extension 형식으로 변환\n */\nexport class ReduxExtensionBridge {\n  private iframeWindow: Window | null = null;\n  private target: SDK.Target.Target | null = null;\n  private observer: ProtocolClient.CDPConnection.CDPConnectionObserver | null = null;\n  private messagePort: MessagePort | null = null;\n  private messageListeners: Array<(message: any) => void> = [];\n\n  /**\n   * Initialize bridge with iframe window / iframe window로 브릿지 초기화\n   */\n  initialize(iframeWindow: Window): void {\n    this.iframeWindow = iframeWindow;\n    this.injectExtensionAPI();\n  }\n\n  /**\n   * Inject chrome.runtime API into iframe / iframe에 chrome.runtime API 주입\n   */\n  private injectExtensionAPI(): void {\n    if (!this.iframeWindow) {return;}\n\n    // MessageChannel을 사용하여 가상의 MessagePort 생성 / MessageChannel을 사용하여 가상의 MessagePort 생성\n    const channel = new MessageChannel();\n    this.messagePort = channel.port1;\n\n    // MessagePort로 메시지 수신 / MessagePort로 메시지 수신\n    this.messagePort.onmessage = event => {\n      this.handleExtensionMessage(event.data);\n    };\n\n    // Redux DevTools Extension이 사용하는 chrome.runtime API 시뮬레이션 / Redux DevTools Extension이 사용하는 chrome.runtime API 시뮬레이션\n    (this.iframeWindow as any).chrome = {\n      runtime: {\n        // Connect to background script / background script에 연결\n        connect: (options?: { name?: string }) => {\n          // MessagePort를 반환하여 Extension이 통신할 수 있도록 함 / MessagePort를 반환하여 Extension이 통신할 수 있도록 함\n          return this.messagePort;\n        },\n        // Send message to background script / background script로 메시지 전송\n        sendMessage: (message: any, callback?: (response: any) => void) => {\n          this.handleExtensionMessage(message);\n          if (callback) {\n            callback({ success: true });\n          }\n        },\n        // Listen to messages from background script / background script로부터 메시지 수신\n        onMessage: {\n          addListener: (callback: (message: any) => void) => {\n            this.messageListeners.push(callback);\n          },\n          removeListener: (callback: (message: any) => void) => {\n            const index = this.messageListeners.indexOf(callback);\n            if (index > -1) {\n              this.messageListeners.splice(index, 1);\n            }\n          },\n        },\n        // Get URL for extension resource / extension 리소스 URL 가져오기\n        getURL: (path: string) => {\n          return `devtools://devtools/bundled/panels/redux/extension/${path}`;\n        },\n      },\n      devtools: {\n        inspectedWindow: {\n          // Evaluate script in inspected page / inspected page에서 스크립트 실행\n          eval: (expression: string, callback?: (result: any, exceptionInfo?: any) => void) => {\n            this.evaluateInInspectedPage(expression, callback);\n          },\n          // Get resources from inspected page / inspected page의 리소스 가져오기\n          getResources: (callback?: (resources: Array<{url: string}>) => void) => {\n            this.getPageResources(callback);\n          },\n          // Tab ID (not used in this context) / Tab ID (이 컨텍스트에서 사용되지 않음)\n          get tabId() {\n            return undefined;\n          },\n        },\n      },\n    };\n  }\n\n  /**\n   * Handle messages from Redux DevTools Extension / Redux DevTools Extension으로부터 메시지 처리\n   */\n  private handleExtensionMessage(message: any): void {\n    // Redux DevTools Extension의 메시지를 처리 / Redux DevTools Extension의 메시지를 처리\n    // 여기서는 CDP 메시지로 변환하거나 필요한 작업 수행 / 여기서는 CDP 메시지로 변환하거나 필요한 작업 수행\n    console.log('[ReduxExtensionBridge] Received message from extension:', message);\n  }\n\n  /**\n   * Send message to Redux DevTools Extension iframe / Redux DevTools Extension iframe으로 메시지 전송\n   */\n  private sendToExtension(message: any): void {\n    if (!this.iframeWindow || !this.messagePort) {return;}\n\n    // MessagePort로 메시지 전송 / MessagePort로 메시지 전송\n    this.messagePort.postMessage(message);\n\n    // 또는 postMessage로 직접 전송 / 또는 postMessage로 직접 전송\n    this.iframeWindow.postMessage(message, '*');\n  }\n\n  /**\n   * Attach to target and listen for Redux CDP events / 타겟에 연결하고 Redux CDP 이벤트 리스닝\n   */\n  attachToTarget(target: SDK.Target.Target, connection: ProtocolClient.CDPConnection.CDPConnection): void {\n    this.target = target;\n\n    this.observer = {\n      onEvent: (\n        event: ProtocolClient.CDPConnection.CDPEvent<ProtocolClient.CDPConnection.Event>\n      ): void => {\n        // Redux CDP 이벤트를 Redux DevTools Extension 형식으로 변환 / Redux CDP 이벤트를 Redux DevTools Extension 형식으로 변환\n        const method = event.method as string;\n        if (method === 'Redux.init' ||\n            method === 'Redux.actionDispatched' ||\n            method === 'Redux.error') {\n          this.convertCDPToExtensionMessage(event);\n        }\n      },\n      onDisconnect: (_reason: string): void => {\n        this.observer = null;\n      },\n    };\n\n    connection.observe(this.observer);\n  }\n\n  /**\n   * Convert CDP message to Extension message format / CDP 메시지를 Extension 메시지 형식으로 변환\n   */\n  private convertCDPToExtensionMessage(event: ProtocolClient.CDPConnection.CDPEvent<any>): void {\n    const params = event.params as any;\n\n    // Redux DevTools Extension이 기대하는 메시지 형식으로 변환 / Redux DevTools Extension이 기대하는 메시지 형식으로 변환\n    const extensionMessage = {\n      type: 'REDUX_MESSAGE',\n      method: event.method,\n      params,\n      timestamp: Date.now(),\n    };\n\n    this.sendToExtension(extensionMessage);\n  }\n\n  /**\n   * Evaluate script in inspected page / inspected page에서 스크립트 실행\n   */\n  private evaluateInInspectedPage(\n    expression: string,\n    callback?: (result: any, exceptionInfo?: any) => void\n  ): void {\n    if (!this.target) {\n      if (callback) {callback(null, { isException: true, value: 'No target available' });}\n      return;\n    }\n\n    const runtimeModel = this.target.model(SDK.RuntimeModel.RuntimeModel);\n    if (!runtimeModel) {\n      if (callback) {callback(null, { isException: true, value: 'No runtime model available' });}\n      return;\n    }\n\n    // Use Runtime API directly / Runtime API 직접 사용\n    this.target.runtimeAgent().invoke_evaluate({\n      expression,\n      returnByValue: true,\n    }).then((response: Protocol.Runtime.EvaluateResponse) => {\n      if (callback) {\n        if (response.exceptionDetails) {\n          callback(null, {\n            isException: true,\n            value: response.exceptionDetails.text || 'Unknown error',\n          });\n        } else {\n          callback(response.result?.value, undefined);\n        }\n      }\n    }).catch((error: Error) => {\n      if (callback) {callback(null, { isException: true, value: error.message });}\n    });\n  }\n\n  /**\n   * Get page resources / 페이지 리소스 가져오기\n   */\n  private getPageResources(callback?: (resources: Array<{url: string}>) => void): void {\n    // Always return at least the current page URL / 항상 최소한 현재 페이지 URL 반환\n    const resources: Array<{url: string}> = [];\n\n    if (!this.target) {\n      // Fallback: use about:blank if no target / 타겟이 없으면 about:blank 사용\n      if (callback) {\n        callback([{url: 'about:blank'}]);\n      }\n      return;\n    }\n\n    // Get inspected URL (current page URL) / inspected URL 가져오기 (현재 페이지 URL)\n    const inspectedUrl = this.target.inspectedURL();\n    if (inspectedUrl) {\n      resources.push({url: inspectedUrl});\n    }\n\n    const resourceTreeModel = this.target.model(SDK.ResourceTreeModel.ResourceTreeModel);\n    if (resourceTreeModel?.mainFrame) {\n      // Get main frame URL if different from inspected URL / inspected URL과 다르면 메인 프레임 URL 가져오기\n      const mainFrameUrl = resourceTreeModel.mainFrame.url;\n      if (mainFrameUrl && mainFrameUrl !== inspectedUrl && !resources.some(r => r.url === mainFrameUrl)) {\n        resources.push({url: mainFrameUrl});\n      }\n\n      // Get all resources from the main frame / 메인 프레임의 모든 리소스 가져오기\n      resourceTreeModel.mainFrame.resources().forEach(resource => {\n        const url = resource.url;\n        if (url && !resources.some(r => r.url === url)) {\n          resources.push({url});\n        }\n      });\n    }\n\n    // Ensure at least one resource is returned / 최소한 하나의 리소스는 반환\n    if (resources.length === 0) {\n      resources.push({url: inspectedUrl || 'about:blank'});\n    }\n\n    if (callback) {\n      callback(resources);\n    }\n  }\n\n  /**\n   * Cleanup / 정리\n   */\n  cleanup(): void {\n    if (this.observer && this.target) {\n      const router = this.target.router();\n      if (router?.connection) {\n        router.connection.unobserve(this.observer);\n      }\n      this.observer = null;\n    }\n    this.messageListeners = [];\n  }\n}\n\n"],
  "mappings": ";;;;;;;AAAA;;;;AAIA,YAAY,QAAQ;AAEpB,YAAYA,UAAS;AAErB,YAAY,UAAU;;;ACHtB,YAAY,SAAS;AAOf,IAAO,uBAAP,MAA2B;EACvB,eAA8B;EAC9B,SAAmC;EACnC,WAAsE;EACtE,cAAkC;EAClC,mBAAkD,CAAA;;;;EAK1D,WAAW,cAAoB;AAC7B,SAAK,eAAe;AACpB,SAAK,mBAAkB;EACzB;;;;EAKQ,qBAAkB;AACxB,QAAI,CAAC,KAAK,cAAc;AAAC;IAAO;AAGhC,UAAM,UAAU,IAAI,eAAc;AAClC,SAAK,cAAc,QAAQ;AAG3B,SAAK,YAAY,YAAY,WAAQ;AACnC,WAAK,uBAAuB,MAAM,IAAI;IACxC;AAGC,SAAK,aAAqB,SAAS;MAClC,SAAS;;QAEP,SAAS,CAAC,YAA+B;AAEvC,iBAAO,KAAK;QACd;;QAEA,aAAa,CAAC,SAAc,aAAsC;AAChE,eAAK,uBAAuB,OAAO;AACnC,cAAI,UAAU;AACZ,qBAAS,EAAE,SAAS,KAAI,CAAE;UAC5B;QACF;;QAEA,WAAW;UACT,aAAa,CAAC,aAAoC;AAChD,iBAAK,iBAAiB,KAAK,QAAQ;UACrC;UACA,gBAAgB,CAAC,aAAoC;AACnD,kBAAM,QAAQ,KAAK,iBAAiB,QAAQ,QAAQ;AACpD,gBAAI,QAAQ,IAAI;AACd,mBAAK,iBAAiB,OAAO,OAAO,CAAC;YACvC;UACF;;;QAGF,QAAQ,CAAC,SAAgB;AACvB,iBAAO,sDAAsD,IAAI;QACnE;;MAEF,UAAU;QACR,iBAAiB;;UAEf,MAAM,CAAC,YAAoB,aAAyD;AAClF,iBAAK,wBAAwB,YAAY,QAAQ;UACnD;;UAEA,cAAc,CAAC,aAAwD;AACrE,iBAAK,iBAAiB,QAAQ;UAChC;;UAEA,IAAI,QAAK;AACP,mBAAO;UACT;;;;EAIR;;;;EAKQ,uBAAuB,SAAY;AAGzC,YAAQ,IAAI,2DAA2D,OAAO;EAChF;;;;EAKQ,gBAAgB,SAAY;AAClC,QAAI,CAAC,KAAK,gBAAgB,CAAC,KAAK,aAAa;AAAC;IAAO;AAGrD,SAAK,YAAY,YAAY,OAAO;AAGpC,SAAK,aAAa,YAAY,SAAS,GAAG;EAC5C;;;;EAKA,eAAe,QAA2B,YAAsD;AAC9F,SAAK,SAAS;AAEd,SAAK,WAAW;MACd,SAAS,CACP,UACQ;AAER,cAAM,SAAS,MAAM;AACrB,YAAI,WAAW,gBACX,WAAW,4BACX,WAAW,eAAe;AAC5B,eAAK,6BAA6B,KAAK;QACzC;MACF;MACA,cAAc,CAAC,YAAyB;AACtC,aAAK,WAAW;MAClB;;AAGF,eAAW,QAAQ,KAAK,QAAQ;EAClC;;;;EAKQ,6BAA6B,OAAiD;AACpF,UAAM,SAAS,MAAM;AAGrB,UAAM,mBAAmB;MACvB,MAAM;MACN,QAAQ,MAAM;MACd;MACA,WAAW,KAAK,IAAG;;AAGrB,SAAK,gBAAgB,gBAAgB;EACvC;;;;EAKQ,wBACN,YACA,UAAqD;AAErD,QAAI,CAAC,KAAK,QAAQ;AAChB,UAAI,UAAU;AAAC,iBAAS,MAAM,EAAE,aAAa,MAAM,OAAO,sBAAqB,CAAE;MAAE;AACnF;IACF;AAEA,UAAM,eAAe,KAAK,OAAO,MAAU,iBAAa,YAAY;AACpE,QAAI,CAAC,cAAc;AACjB,UAAI,UAAU;AAAC,iBAAS,MAAM,EAAE,aAAa,MAAM,OAAO,6BAA4B,CAAE;MAAE;AAC1F;IACF;AAGA,SAAK,OAAO,aAAY,EAAG,gBAAgB;MACzC;MACA,eAAe;KAChB,EAAE,KAAK,CAAC,aAA+C;AACtD,UAAI,UAAU;AACZ,YAAI,SAAS,kBAAkB;AAC7B,mBAAS,MAAM;YACb,aAAa;YACb,OAAO,SAAS,iBAAiB,QAAQ;WAC1C;QACH,OAAO;AACL,mBAAS,SAAS,QAAQ,OAAO,MAAS;QAC5C;MACF;IACF,CAAC,EAAE,MAAM,CAAC,UAAgB;AACxB,UAAI,UAAU;AAAC,iBAAS,MAAM,EAAE,aAAa,MAAM,OAAO,MAAM,QAAO,CAAE;MAAE;IAC7E,CAAC;EACH;;;;EAKQ,iBAAiB,UAAoD;AAE3E,UAAM,YAAkC,CAAA;AAExC,QAAI,CAAC,KAAK,QAAQ;AAEhB,UAAI,UAAU;AACZ,iBAAS,CAAC,EAAC,KAAK,cAAa,CAAC,CAAC;MACjC;AACA;IACF;AAGA,UAAM,eAAe,KAAK,OAAO,aAAY;AAC7C,QAAI,cAAc;AAChB,gBAAU,KAAK,EAAC,KAAK,aAAY,CAAC;IACpC;AAEA,UAAM,oBAAoB,KAAK,OAAO,MAAU,sBAAkB,iBAAiB;AACnF,QAAI,mBAAmB,WAAW;AAEhC,YAAM,eAAe,kBAAkB,UAAU;AACjD,UAAI,gBAAgB,iBAAiB,gBAAgB,CAAC,UAAU,KAAK,OAAK,EAAE,QAAQ,YAAY,GAAG;AACjG,kBAAU,KAAK,EAAC,KAAK,aAAY,CAAC;MACpC;AAGA,wBAAkB,UAAU,UAAS,EAAG,QAAQ,cAAW;AACzD,cAAM,MAAM,SAAS;AACrB,YAAI,OAAO,CAAC,UAAU,KAAK,OAAK,EAAE,QAAQ,GAAG,GAAG;AAC9C,oBAAU,KAAK,EAAC,IAAG,CAAC;QACtB;MACF,CAAC;IACH;AAGA,QAAI,UAAU,WAAW,GAAG;AAC1B,gBAAU,KAAK,EAAC,KAAK,gBAAgB,cAAa,CAAC;IACrD;AAEA,QAAI,UAAU;AACZ,eAAS,SAAS;IACpB;EACF;;;;EAKA,UAAO;AACL,QAAI,KAAK,YAAY,KAAK,QAAQ;AAChC,YAAM,SAAS,KAAK,OAAO,OAAM;AACjC,UAAI,QAAQ,YAAY;AACtB,eAAO,WAAW,UAAU,KAAK,QAAQ;MAC3C;AACA,WAAK,WAAW;IAClB;AACA,SAAK,mBAAmB,CAAA;EAC1B;;;;ADrPI,IAAO,aAAP,cAA6B,SAAM,MAAK;EAC5C,UAAoC;EACpC;EACA,UAAoC;EAEpC,cAAA;AACE,UAAM,OAAO;AACb,SAAK,gBAAe;AAEpB,SAAK,UAAU,IAAI,qBAAoB;AAGvC,SAAK,UAAU,SAAS,cAAc,QAAQ;AAC9C,SAAK,QAAQ,YAAY;AACzB,SAAK,QAAQ,MAAM,QAAQ;AAC3B,SAAK,QAAQ,MAAM,SAAS;AAC5B,SAAK,QAAQ,MAAM,SAAS;AAI5B,UAAM,aAAkB,aAAQ,cAAa;AAC7C,QAAI;AACJ,QAAI,YAAY;AAEd,0BAAoB,GAAG,WAAW,IAAI;IACxC,OAAO;AAEL,YAAM,cAAc,OAAO,SAAS;AACpC,YAAM,WAAW,YAAY,UAAU,GAAG,YAAY,YAAY,GAAG,CAAC;AACtE,0BAAoB,GAAG,QAAQ;IACjC;AACA,SAAK,QAAQ,MAAM;AAEnB,SAAK,QAAQ,SAAS,MAAK;AACzB,UAAI,KAAK,SAAS,eAAe;AAC/B,aAAK,QAAQ,WAAW,KAAK,QAAQ,aAAa;MACpD;IACF;AAEA,SAAK,eAAe,YAAY,KAAK,OAAO;AAG5C,SAAK,iBAAgB;EACvB;EAES,WAAQ;AACf,UAAM,SAAQ;AACd,SAAK,iBAAgB;EACvB;EAES,WAAQ;AACf,UAAM,SAAQ;AACd,SAAK,mBAAkB;EACzB;EAGQ,mBAAgB;AACtB,UAAM,SAAa,mBAAc,cAAc,SAAQ,EAAG,kBAAiB;AAC3E,QAAI,CAAC,QAAQ;AACX,MAAI,mBAAc,cAAc,SAAQ,EAAG,iBAAgB,2BAEzD,MAAK;AACH,cAAM,YAAgB,mBAAc,cAAc,SAAQ,EAAG,kBAAiB;AAC9E,YAAI,aAAa,CAAC,KAAK,SAAS;AAC9B,eAAK,UAAU;AACf,eAAK,eAAe,SAAS;QAC/B;MACF,GACA,IAAI;AAEN;IACF;AAEA,SAAK,UAAU;AACf,SAAK,eAAe,MAAM;EAC5B;EAEQ,eAAe,QAAyB;AAC9C,UAAM,SAAS,OAAO,OAAM;AAC5B,QAAI,CAAC,QAAQ,YAAY;AACvB;IACF;AAGA,SAAK,QAAQ,eAAe,QAAQ,OAAO,UAAU;EACvD;EAEQ,qBAAkB;AACxB,SAAK,QAAQ,QAAO;EACtB;;",
  "names": ["SDK"]
}

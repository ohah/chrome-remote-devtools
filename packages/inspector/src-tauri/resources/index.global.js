(()=>{var{defineProperty:s,getOwnPropertyNames:iX,getOwnPropertyDescriptor:lX}=Object,aX=Object.prototype.hasOwnProperty;var BX=new WeakMap,dX=(X)=>{var Z=BX.get(X),J;if(Z)return Z;if(Z=s({},"__esModule",{value:!0}),X&&typeof X==="object"||typeof X==="function")iX(X).map((Q)=>!aX.call(Z,Q)&&s(Z,Q,{get:()=>X[Q],enumerable:!(J=lX(X,Q))||J.enumerable}));return BX.set(X,Z),Z};var t=(X,Z)=>{for(var J in Z)s(X,J,{get:Z[J],enumerable:!0,configurable:!0,set:(Q)=>Z[J]=()=>Q})};var nX=((X)=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(X,{get:(Z,J)=>(typeof require<"u"?require:Z)[J]}):X)(function(X){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+X+'" is not supported')});var UX={};t(UX,{isCompressionSupported:()=>$X,isCompressed:()=>QZ,decompress:()=>JZ,compress:()=>HX});function $X(){return typeof CompressionStream<"u"&&typeof DecompressionStream<"u"}async function HX(X){if(!$X())return null;try{let Z=new TextEncoder,Q=new ReadableStream({start(G){G.enqueue(Z.encode(X)),G.close()}}).pipeThrough(new CompressionStream("gzip"));return await new Response(Q).arrayBuffer()}catch(Z){return console.error("Compression failed / 압축 실패:",Z),null}}async function JZ(X){if(!$X())return null;try{let J=new ReadableStream({start(Y){Y.enqueue(X),Y.close()}}).pipeThrough(new DecompressionStream("gzip")),K=await new Response(J).arrayBuffer();return new TextDecoder().decode(K)}catch(Z){return console.error("Decompression failed / 압축 해제 실패:",Z),null}}function QZ(X){if(!X||X.byteLength<3)return!1;let Z=new Uint8Array(X);return Z[0]===31&&Z[1]===139&&Z[2]===8}var vX={};t(vX,{injectExportButton:()=>$Z});function $Z(X){if(document.getElementById("chrome-remote-devtools-export-btn"))return;let Z=document.createElement("button");Z.id="chrome-remote-devtools-export-btn",Z.title="Export CDP events to JSON file",Z.innerHTML=`
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M10 13V3M10 13L6 9M10 13L14 9M3 16H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  `,Z.style.cssText=`
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 999999;
    padding: 12px;
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
  `,Z.addEventListener("click",async()=>{Z.disabled=!0,Z.innerHTML=`
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="animation: spin 1s linear infinite;">
        <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2" stroke-opacity="0.3" fill="none"/>
        <path d="M10 2C10 2 13 6 13 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <style>
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        </style>
      </svg>
    `;try{await X.exportToFile(),Z.innerHTML=`
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M16.5 5.5L7.5 14.5L3.5 10.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      `,setTimeout(()=>{Z.innerHTML=`
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 13V3M10 13L6 9M10 13L14 9M3 16H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        `,Z.disabled=!1},2000)}catch(J){console.error("Failed to export events / 이벤트 내보내기 실패:",J),Z.innerHTML=`
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2" fill="none"/>
          <path d="M10 6V10M10 14H10.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      `,setTimeout(()=>{Z.innerHTML=`
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 13V3M10 13L6 9M10 13L14 9M3 16H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        `,Z.disabled=!1},2000)}}),document.body.appendChild(Z)}var HZ={};t(HZ,{initCDPClient:()=>mX,init:()=>uX,exportEvents:()=>cX});var e=new Map,T=new Map,XX=new Map,rX=1,LX=(X,Z)=>{let J=e.get(X);if(J)return J;return J=`${rX++}`,T.set(J,X),e.set(X,J),XX.set(J,Z),J},oX=(X)=>{let J=/\[object\s+(.*)\]/.exec(Object.prototype.toString.call(X));return J?J[1]||"":""},sX=(X)=>{try{if(X&&typeof X==="object"&&"nodeType"in X){let J=X;if([1,8,9].includes(J.nodeType))return"node"}}catch{}let Z=oX(X).toLowerCase();return["array","null","regexp","date","map","set","weakmap","weakset","error","proxy","promise","arraybuffer","iterator","generator"].includes(Z)?Z:""},DX=(X)=>({type:typeof X,subtype:sX(X)}),u=(X,Z={})=>{let{length:J=5,origin:Q=X}=Z;if(typeof X!=="object"||X===null)return{overflow:!1,properties:[]};let K=Object.keys(X),G=[];return K.slice(0,J).forEach((Y)=>{let $;try{$=Q[Y]}catch{}let{type:U,subtype:H}=DX($),F;if(U==="object")if(H==="array")F=`Array(${$.length})`;else if(H==="null")F="null";else if(["date","regexp"].includes(H))F=String($);else if(H==="node")F=`#${$.nodeName}`;else try{F=$.constructor.name}catch{F="Object"}else F=$===void 0?"undefined":String($);G.push({name:Y,type:U,subtype:H,value:F})}),{overflow:K.length>J,properties:G}};function j(X,Z={}){let{origin:J=X,preview:Q=!1}=Z,{type:K,subtype:G}=DX(X);if(K==="undefined")return{type:K};if(K==="number")return{type:K,value:X,description:String(X)};if(K==="string"||K==="boolean")return{type:K,value:X};if(K==="symbol")return{type:K,objectId:LX(X,J),description:String(X)};if(G==="null")return{type:K,subtype:G,value:X};let Y={type:K,subtype:G,objectId:LX(X,J)};if(K==="function"){if(Y.className="Function",Y.description=String(X),Q)Y.preview={type:K,subtype:G,description:String(X),...u(X,{origin:J})}}else if(G==="array"){Y.className="Array";let $=X;if(Y.description=`Array(${$.length})`,Q)Y.preview={type:K,subtype:G,description:`Array(${$.length})`,...u(X,{length:100,origin:J})}}else if(G==="error"){Y.className="Error";let $=X;if(Y.description=$.stack||$.message,Q)Y.preview={type:K,subtype:G,description:$.stack||$.message,...u(X,{origin:J})}}else if(G==="node")try{let $=X;Y.className=Y.description=$.constructor.name}catch{Y.className=Y.description=""}else{try{let $=X;Y.className=Y.description=$.constructor.name}catch{Y.className=Y.description=""}if(Q)Y.preview={type:K,subtype:G,description:Y.description,...u(X,{origin:J})}}return Y}function _X(X){let{accessorPropertiesOnly:Z,generatePreview:J,objectId:Q,ownProperties:K}=X,G=T.get(Q);if(!G)return[];let Y=XX.get(Q),$=[],U=G.__proto__,H=U&&!K?U:G,F=Object.getOwnPropertyNames(H);for(let z of F){if(z==="__proto__")continue;let W={name:z,value:void 0},P;try{P=Y[z]}catch{}let B=Object.getOwnPropertyDescriptor(H,z);if(!B)continue;if(Z&&!B.get&&!B.set)continue;W.configurable=B.configurable,W.enumerable=B.enumerable,W.writable=B.writable,W.isOwn=K?!0:U?Object.prototype.hasOwnProperty.call(U,z):!0,W.value=j(P,{preview:J}),$.push(W)}if(U)$.push({name:"__proto__",configurable:!0,enumerable:!1,isOwn:!!K,value:j(U,{origin:Y})});return $}function AX({objectId:X}){let Z=T.get(X);if(Z)T.delete(X),e.delete(Z),XX.delete(X)}function k(X){return T.get(X)}class D{socket;namespace="";eventStorage;devtoolsWindow=null;eventQueue=[];constructor(X){this.socket=X.socket,this.eventStorage=X.eventStorage}setDevToolsWindow(X){this.devtoolsWindow=X,this.flushEventQueue(),this.sendStoredEventsFromIndexedDB()}flushEventQueue(){if(!this.devtoolsWindow||this.eventQueue.length===0)return;while(this.eventQueue.length>0){let X=this.eventQueue.shift();if(X)try{this.devtoolsWindow.postMessage(X,"*")}catch(Z){console.warn("Failed to send queued postMessage event:",Z)}}}createCDPMessage(X){return{type:"CDP_MESSAGE",message:JSON.stringify(X)}}sendViaPostMessage(X,Z){try{return Z.postMessage(X,"*"),!0}catch(J){return console.warn("Failed to send postMessage event:",J),!1}}getTargetWindow(){if(typeof window>"u")return null;if(this.devtoolsWindow)return this.devtoolsWindow;return window.opener||(window!==window.top?window.parent:null)}queueEvent(X){this.eventQueue.push(X)}saveEventToStorage(X,Z){if(this.eventStorage)this.eventStorage.saveEvent(X,Z)}saveMessageToStorage(X){if(this.eventStorage)this.eventStorage.saveMessage(X)}sendViaWebSocket(X){if(this.socket&&this.socket.readyState===WebSocket.OPEN){let Z=JSON.stringify(X);return this.socket.send(Z),!0}return!1}isCDPEvent(X){return typeof X==="object"&&X!==null&&"method"in X&&typeof X.method==="string"&&X.id===void 0}async sendStoredEventsFromIndexedDB(){if(typeof window<"u"&&window.__CHROME_REMOTE_DEVTOOLS_REPLAY_MODE__)return;if(!this.devtoolsWindow||!this.eventStorage)return;try{let X=await this.eventStorage.getEvents();if(X.length>0){let Z=X.filter((J)=>{try{return!(JSON.parse(J.message).method||"").startsWith("SessionReplay.")}catch{return!0}});if(Z.length>0)for(let Q=0;Q<Z.length;Q+=100){let K=Z.slice(Q,Q+100);for(let G of K)this.sendViaPostMessage(G,this.devtoolsWindow);await new Promise((G)=>setTimeout(G,10))}}}catch(X){console.error("Failed to send stored messages to DevTools / 저장된 메시지를 DevTools로 전송 실패:",X)}}enable(){}send(X){if(typeof window<"u"&&window.__CHROME_REMOTE_DEVTOOLS_REPLAY_MODE__)return;if(this.isCDPMessage(X))this.saveMessageToStorage(X);if(this.sendViaWebSocket(X))return;if(this.isCDPMessage(X)){let Z=this.getTargetWindow(),J=this.createCDPMessage(X);if(Z){if(!this.sendViaPostMessage(J,Z))this.queueEvent(J)}else this.queueEvent(J)}}isCDPMessage(X){if(typeof X!=="object"||X===null)return!1;return"method"in X||"id"in X}}var tX={Runtime:["enable","evaluate","getProperties","releaseObject","callFunctionOn"],Page:["enable","startScreencast","stopScreencast","getResourceTree","getResourceContent"],DOM:["enable","getDocument","removeNode","requestChildNodes","requestNode","getOuterHTML","setOuterHTML","setAttributesAsText","setInspectedNode","pushNodesByBackendIdsToFrontend","performSearch","getSearchResults","discardSearchResults","getNodeForLocation","setNodeValue","getBoxModel"],CSS:["enable","getComputedStyleForNode","getMatchedStylesForNode","getInlineStylesForNode","getBackgroundColors","getStyleSheetText","setStyleTexts"],Network:["enable","getCookies","setCookie","deleteCookies","getResponseBody"],Console:["enable","clearMessages"],DOMStorage:["enable","disable","getDOMStorageItems","setDOMStorageItem","removeDOMStorageItem","clear"],Storage:["getStorageKey","replayStoredEvents"],SessionReplay:["enable","disable","sendEvent","replayStoredEvents"]},ZX=tX,V={executionContextCreated:"Runtime.executionContextCreated",consoleAPICalled:"Runtime.consoleAPICalled",exceptionThrown:"Runtime.exceptionThrown",screencastFrame:"Page.screencastFrame",loadEventFired:"Page.loadEventFired",domContentEventFired:"Page.domContentEventFired",setChildNodes:"DOM.setChildNodes",childNodeCountUpdated:"DOM.childNodeCountUpdated",childNodeInserted:"DOM.childNodeInserted",childNodeRemoved:"DOM.childNodeRemoved",attributeModified:"DOM.attributeModified",attributeRemoved:"DOM.attributeRemoved",characterDataModified:"DOM.characterDataModified",documentUpdated:"DOM.documentUpdated",styleSheetAdded:"CSS.styleSheetAdded",styleSheetChanged:"CSS.styleSheetChanged",requestWillBeSent:"Network.requestWillBeSent",responseReceivedExtraInfo:"Network.responseReceivedExtraInfo",responseReceived:"Network.responseReceived",loadingFinished:"Network.loadingFinished",loadingFailed:"Network.loadingFailed",messageAdded:"Console.messageAdded",domStorageItemAdded:"DOMStorage.domStorageItemAdded",domStorageItemRemoved:"DOMStorage.domStorageItemRemoved",domStorageItemUpdated:"DOMStorage.domStorageItemUpdated",domStorageItemsCleared:"DOMStorage.domStorageItemsCleared",sessionReplayEventRecorded:"SessionReplay.eventRecorded"};class Runtime extends D{namespace="Runtime";constructor(X){super(X);this.hookConsole()}enable(){this.send({method:V.executionContextCreated,params:{context:{id:1,name:"top",origin:location.origin}}})}evaluate({expression:X,generatePreview:Z}){try{let J=window.eval(X);return window.$_=J,{result:j(J,{preview:Z})}}catch(J){return{result:j(J,{preview:Z})}}}getProperties(X){return{result:_X(X)}}releaseObject(X){AX(X)}callFunctionOn({functionDeclaration,objectId,arguments:args,silent}){try{let fun=eval(`(() => ${functionDeclaration})()`),resolvedArgs=(args||[]).map((X)=>{if("value"in X)return X.value;if("objectId"in X&&X.objectId)return k(X.objectId);return}),thisArg=objectId?k(objectId):null,result=fun.apply(thisArg,resolvedArgs);if(silent)return;return{result:j(result)}}catch(X){if(silent)return;return{result:j(X)}}}socketSend(X,Z){this.send(Z)}hookConsole(){let X=console,Z={log:"log",debug:"debug",info:"info",error:"error",warn:"warning",dir:"dir",dirxml:"dirxml",table:"table",trace:"trace",clear:"clear",group:"startGroup",groupCollapsed:"startGroupCollapsed",groupEnd:"endGroup"};Object.keys(Z).forEach((J)=>{let Q=X[J];console[J]=(...K)=>{Q?.(...K);let G={method:V.consoleAPICalled,params:{type:Z[J],args:K.map((Y)=>j(Y,{preview:!0})),executionContextId:1,timestamp:Date.now(),stackTrace:{callFrames:["error","warn","trace"].includes(J)?this.getCallFrames():[]}}};this.socketSend("console",G)}})}getCallFrames(X){if(X&&X.stack)return X.stack.split(`
`).slice(1).map((J)=>{let Q=J.match(/at\s+(.+?)\s+\((.+?):(\d+):(\d+)\)/);if(Q&&Q[2]&&Q[3]&&Q[4])return{functionName:Q[1],url:Q[2],lineNumber:parseInt(Q[3],10),columnNumber:parseInt(Q[4],10)};return{}});return[]}}class b extends D{namespace="Page";frame=new Map;intervalTimer=null;enable(){let X=new XMLHttpRequest;X.$$requestType="Document",X.onload=()=>{this.frame.set(location.href,X.responseText)},X.onerror=()=>{this.frame.set(location.href,"Cannot get script source code")},X.open("GET",location.href),X.send()}getResourceTree(){return{frameTree:{frame:{id:"1",mimeType:"text/html",securityOrigin:location.origin,url:location.href},resources:[]}}}getResourceContent({url:X}){return{content:this.frame.get(X)}}startScreencast(){let X=()=>{if(document.hidden)return;try{let Z=document.createElement("canvas");Z.width=window.innerWidth,Z.height=window.innerHeight;let J=Z.getContext("2d");if(J){J.fillStyle="#ffffff",J.fillRect(0,0,Z.width,Z.height);let Q=Z.toDataURL("image/jpeg",0.8);this.send({method:V.screencastFrame,params:{data:Q.replace(/^data:image\/jpeg;base64,/,""),metadata:{deviceHeight:window.innerHeight,deviceWidth:window.innerWidth,pageScaleFactor:1,offsetTop:0,scrollOffsetX:window.scrollX,scrollOffsetY:window.scrollY,timestamp:Date.now()}}})}}catch(Z){}};X(),this.intervalTimer=setInterval(X,1000)}stopScreencast(){if(this.intervalTimer)clearInterval(this.intervalTimer),this.intervalTimer=null}}var OX=new WeakMap,wX=new Map,eX=1;function _(X){let Z=OX.get(X);if(!Z)Z=eX++,OX.set(X,Z),wX.set(Z,X);return Z}function O(X){let Z=wX.get(X);if(!Z)return null;return Z}function fX(X){let Z=X.previousSibling;while(Z&&!c(Z))Z=Z.previousSibling;return Z}function c(X){if(X.nodeType===Node.TEXT_NODE)return(X.nodeValue||"").trim()!=="";return!0}function JX(X){return Array.from(X).filter((Z)=>c(Z))}function M(X,Z=0){let J=_(X),K={nodeId:J,backendNodeId:J,nodeType:X.nodeType,nodeName:X.nodeName};if(X.nodeType===Node.ELEMENT_NODE){let G=X;K.localName=G.localName;let Y=[];Array.from(G.attributes).forEach((U)=>{Y.push(U.name,U.value)}),K.attributes=Y;let $=JX(G.childNodes);if(K.childNodeCount=$.length,(Z===-1||Z>0)&&$.length>0){let U=Z===-1?-1:Z-1;K.children=$.map((H)=>M(H,U))}}else if(X.nodeType===Node.TEXT_NODE||X.nodeType===Node.COMMENT_NODE)K.nodeValue=X.nodeValue||"";else if(X.nodeType===Node.DOCUMENT_TYPE_NODE){let G=X;K.nodeValue=G.name||"",K.publicId=G.publicId||"",K.systemId=G.systemId||""}else if(X.nodeType===Node.DOCUMENT_NODE){let G=JX(X.childNodes);if(K.childNodeCount=G.length,(Z===-1||Z>0)&&G.length>0){let Y=Z===-1?-1:Z-1;K.children=G.map(($)=>M($,Y))}}return K}class E extends D{namespace="DOM";searchId=0;searchRet=new Map;currentSearchKey="";registeredNodes=new WeakSet;enable(){let X=(Z)=>{if(this.registeredNodes.add(Z),Z.nodeType===Node.ELEMENT_NODE)Z.childNodes.forEach((J)=>{if(J.nodeType===Node.ELEMENT_NODE||J.nodeType===Node.TEXT_NODE||J.nodeType===Node.COMMENT_NODE)X(J)})};X(document),this.nodeObserver(),E.set$Function()}getDocument(X){let Z=X?.depth??-1,J=(K)=>{if(this.registeredNodes.add(K),K.nodeType===Node.ELEMENT_NODE||K.nodeType===Node.DOCUMENT_NODE)K.childNodes.forEach((G)=>{if(G.nodeType===Node.ELEMENT_NODE||G.nodeType===Node.TEXT_NODE||G.nodeType===Node.COMMENT_NODE||G.nodeType===Node.DOCUMENT_TYPE_NODE)J(G)})};J(document);let Q=M(document,Z);if(Q.nodeType===Node.DOCUMENT_NODE)Q.documentURL=document.URL||location.href,Q.baseURL=document.baseURI||location.href;return{root:Q}}requestChildNodes({nodeId:X}){let Z=O(X);if(!Z){console.warn(`[CDP DOM] requestChildNodes: Node not found for nodeId: ${X}`);return}if(Z.nodeType!==Node.ELEMENT_NODE){console.warn(`[CDP DOM] requestChildNodes: Node ${X} is not an element node (nodeType: ${Z.nodeType})`);return}this.registeredNodes.add(Z);let J=Z;J.childNodes.forEach((G)=>{if(G.nodeType===Node.ELEMENT_NODE)this.registeredNodes.add(G)});let K=JX(J.childNodes).map((G)=>M(G,0));this.send({method:V.setChildNodes,params:{parentId:X,nodes:K}})}getOuterHTML({nodeId:X}){let Z=O(X);if(!Z)return console.warn(`[CDP DOM] getOuterHTML: Node not found for nodeId: ${X}`),{outerHTML:""};if(Z.nodeType!==Node.ELEMENT_NODE)return console.warn(`[CDP DOM] getOuterHTML: Node ${X} is not an element node (nodeType: ${Z.nodeType})`),{outerHTML:""};return{outerHTML:Z.outerHTML}}setOuterHTML({nodeId:X,outerHTML:Z}){let J=O(X);if(!J){console.warn(`[CDP DOM] setOuterHTML: Node not found for nodeId: ${X}`);return}if(J.nodeType!==Node.ELEMENT_NODE){console.warn(`[CDP DOM] setOuterHTML: Node ${X} is not an element node (nodeType: ${J.nodeType})`);return}J.outerHTML=Z}setAttributesAsText({nodeId:X,text:Z}){let J=O(X);if(!J){console.warn(`[CDP DOM] setAttributesAsText: Node not found for nodeId: ${X}`);return}if(J.nodeType!==Node.ELEMENT_NODE){console.warn(`[CDP DOM] setAttributesAsText: Node ${X} is not an element node (nodeType: ${J.nodeType})`);return}let Q=J;if(Z)Z.split(" ").filter((K)=>K).forEach((K)=>{let[G,Y]=K.split("=");if(G&&Y)Q.setAttribute(G,Y.replace(/["']/g,""))});else Array.from(Q.attributes).forEach((K)=>Q.removeAttribute(K.name))}requestNode({objectId:X}){let Z=k(X);if(!Z)throw Error(`Node not found for objectId: ${X}`);return{nodeId:_(Z)}}setInspectedNode({nodeId:X}){let Z=O(X);if(!Z){console.warn(`[CDP DOM] setInspectedNode: Node not found for nodeId: ${X}`),window.$0=null;return}window.$0=Z}performSearch({query:X}){this.currentSearchKey=X;let Z=++this.searchId,J=[];try{let Q=document.querySelectorAll(X);J.push(...Array.from(Q))}catch{}return this.searchRet.set(Z,J),{searchId:Z,resultCount:J.length}}getSearchResults({searchId:X,fromIndex:Z,toIndex:J}){let Q=this.searchRet.get(X)||[],K=Z||0,G=J!==void 0?J:Q.length;return{nodeIds:Q.slice(K,G).map(($)=>_($))}}discardSearchResults({searchId:X}){this.searchRet.delete(X)}getNodeForLocation({x:X,y:Z}){let J=document.elementFromPoint(X,Z);if(!J)throw Error(`Node not found at location (${X}, ${Z})`);return{nodeId:_(J)}}setNodeValue({nodeId:X,value:Z}){let J=O(X);if(!J){console.warn(`[CDP DOM] setNodeValue: Node not found for nodeId: ${X}`);return}J.nodeValue=Z}getBoxModel({nodeId:X}){let Z=O(X);if(!Z)throw Error(`Node not found for nodeId: ${X}`);if(Z.nodeType!==Node.ELEMENT_NODE)throw Error(`Node ${X} is not an element node (nodeType: ${Z.nodeType})`);let J=Z,Q=J.getBoundingClientRect(),K=window.getComputedStyle(J),G=parseFloat(K.paddingTop)||0,Y=parseFloat(K.paddingRight)||0,$=parseFloat(K.paddingBottom)||0,U=parseFloat(K.paddingLeft)||0,H=parseFloat(K.borderTopWidth)||0,F=parseFloat(K.borderRightWidth)||0,z=parseFloat(K.borderBottomWidth)||0,W=parseFloat(K.borderLeftWidth)||0,P=parseFloat(K.marginTop)||0,B=parseFloat(K.marginRight)||0,A=parseFloat(K.marginBottom)||0,q=parseFloat(K.marginLeft)||0;return{model:{content:[Q.left,Q.top,Q.right,Q.bottom],padding:[Q.left,Q.top+G,Q.right,Q.top+G+Q.height-$],border:[Q.left-W,Q.top-H,Q.right+F,Q.bottom+z],margin:[Q.left-W-q,Q.top-H-P,Q.right+F+B,Q.bottom+z+A],width:Q.width,height:Q.height}}}removeNode({nodeId:X}){let Z=O(X);if(!Z){console.warn(`[CDP DOM] removeNode: Node not found for nodeId: ${X}`);return}if(Z.parentNode)Z.parentNode.removeChild(Z)}pushNodesByBackendIdsToFrontend({backendNodeIds:X}){return{nodeIds:X.map((J)=>{let Q=O(J);return Q?_(Q):0}).filter((J)=>J>0)}}nodeObserver(){new MutationObserver((Z)=>{Z.forEach((J)=>{if(J.type==="childList")J.addedNodes.forEach((Q)=>{if(!c(Q))return;if(Q.nodeType===Node.ELEMENT_NODE){let K=J.target,G=K?_(K):0;if(G>0&&this.registeredNodes.has(K)){let Y=fX(Q),$=Y?_(Y):0;this.send({method:V.childNodeInserted,params:{parentNodeId:G,previousNodeId:$,node:M(Q,0)}}),this.registeredNodes.add(Q)}}else if(Q.nodeType===Node.TEXT_NODE||Q.nodeType===Node.COMMENT_NODE){let K=J.target,G=K?_(K):0;if(G>0&&this.registeredNodes.has(K)){let Y=fX(Q),$=Y?_(Y):0;this.send({method:V.childNodeInserted,params:{parentNodeId:G,previousNodeId:$,node:M(Q,0)}}),this.registeredNodes.add(Q)}}}),J.removedNodes.forEach((Q)=>{if(!c(Q))return;if(Q.nodeType===Node.ELEMENT_NODE||Q.nodeType===Node.TEXT_NODE||Q.nodeType===Node.COMMENT_NODE){let K=J.target,G=K?_(K):0,Y=_(Q);if(G>0&&Y>0&&this.registeredNodes.has(K))this.send({method:V.childNodeRemoved,params:{parentNodeId:G,nodeId:Y}});this.registeredNodes.delete(Q)}});else if(J.type==="attributes"){let Q=J.target;this.send({method:V.attributeModified,params:{nodeId:_(Q),name:J.attributeName||"",value:Q.getAttribute(J.attributeName||"")||""}})}else if(J.type==="characterData")this.send({method:V.characterDataModified,params:{nodeId:_(J.target),characterData:J.target.nodeValue||""}})})}).observe(document,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0})}static set$Function(){if(typeof window.$!=="function")window.$=(X)=>document.querySelector(X);if(typeof window.$$!=="function")window.$$=(X)=>document.querySelectorAll(X);if(typeof window.$x!=="function")window.$x=(X)=>{let Z=document.evaluate(X,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),J=[];for(let Q=0;Q<Z.snapshotLength;Q++){let K=Z.snapshotItem(Q);if(K)J.push(K)}return J}}}function KX(X,Z){try{return X.matches(Z)}catch{return!1}}var QX=new WeakMap,jX=new Map,CX=new Map;function qX(X=""){if(X){let Z=0;for(let J=0;J<X.length;J++){let Q=X.charCodeAt(J);Z=(Z<<5)-Z+Q,Z=Z&Z}return`stylesheet-${Math.abs(Z)}`}return`stylesheet-inline-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}function x(X){let Z=QX.get(X);if(!Z){let J=X.href||"";Z=qX(J),QX.set(X,Z)}return Z}function GX(){return Array.from(document.styleSheets).forEach((X)=>{if(!QX.has(X))x(X)}),document.styleSheets}function R(X){let Z={};for(let J=0,Q=X.length;J<Q;J++){let K=X[J];if(K){let G=X[K]||X.getPropertyValue(K);if(G)Z[K]=G.trim()}}return Z}function l(X,Z,J,Q,K,G=0){Array.from(X).forEach((Y)=>{K.totalRules++;let $=Y.selectorText;if($){let U=Y;K.styleRules++,K.allSelectors.push($);let H=!1;try{H=KX(Z,$)}catch{return}if(!H)return;K.matchedRules++;let F=XZ($);Q.push({selectorText:$,style:U.style,styleSheetId:J,priority:F})}else if(Y.type===CSSRule.MEDIA_RULE){let U=Y;try{if(U.cssRules)l(U.cssRules,Z,J,Q,K,G+1)}catch{}}else if(Y.type===16||Y.name==="layer")try{let U=Y.cssRules;if(U)l(U,Z,J,Q,K,G+1)}catch{}else if(Y.cssRules)try{l(Y.cssRules,Z,J,Q,K,G+1)}catch{}})}function a(X){let Z=[],J={totalRules:0,styleRules:0,matchedRules:0,allSelectors:[]};return Array.from(document.styleSheets).forEach((G)=>{let Y=x(G),$=null;try{if($=G.cssRules,!$)return}catch{return}l($,X,Y,Z,J,0)}),Z.sort((G,Y)=>Y.priority-G.priority).map(({priority:G,...Y})=>Y)}function XZ(X){let Z=(X.match(/#/g)||[]).length,J=(X.match(/\./g)||[]).length,Q=X.split(/[#.\s>+~[\]]/).filter((K)=>K&&/^[a-zA-Z]/.test(K)).length;return Z*1000+J*100+Q}function MX(X){let Z=jX.get(X);if(Z)return Z;return Z=qX(),jX.set(X,Z),CX.set(Z,X),Z}function d(X){return CX.get(X)}var i=new Map;async function EX(X){if(i.has(X))return i.get(X);if(d(X))return"";for(let J=0;J<document.styleSheets.length;J++){let Q=document.styleSheets[J];if(!Q)continue;if(x(Q)===X){let K=Q.href;if(K)try{let Y=await(await fetch(K)).text();return i.set(X,Y),Y}catch{return""}else{let G=Array.from(Q.cssRules).map((Y)=>Y.cssText).join(`
`);return i.set(X,G),G}}}return""}function n(X){let Z=["background","font","border","margin","padding","animation","transition","flex","flex-flow","grid","grid-area","grid-column","grid-row","grid-template","gap","place-content","place-items","place-self","outline","list-style","border-radius","border-color","border-style","border-width","border-top","border-right","border-bottom","border-left","border-block","border-inline","columns","column-rule"],J=[];return Z.forEach((Q)=>{let K=X[Q];if(K)J.push({name:Q,value:K})}),J}function S(X){return Object.entries(X).map(([Z,J])=>({name:Z,value:J}))}function ZZ(X){let Z="",J=!1,Q=null,K=!1,G=!1;for(let Y=0;Y<X.length;Y++){let $=X[Y],U=Y+1<X.length?X[Y+1]:"";if(J){if($==="*"&&U==="/")J=!1,Y++;continue}if(Q){if(Z+=$,G)G=!1;else if($==="\\")G=!0;else if($===Q)Q=null;continue}if(K){if(Z+=$,!Q&&($==='"'||$==="'"))Q=$;else if($===")")K=!1;continue}if($==="/"&&U==="*"){J=!0,Y++;continue}if($==='"'||$==="'"){Q=$,Z+=$;continue}if(($==="u"||$==="U")&&X.slice(Y,Y+4).toLowerCase()==="url("){K=!0,Z+="url(",Y+=3;continue}Z+=$}return Z}function xX(X){let J=ZZ(X).split(";"),Q={};return J.forEach((K)=>{let G=K.trim();if(!G)return;let Y=G.indexOf(":");if(Y>0){let $=G.slice(0,Y).trim(),U=G.slice(Y+1).trim();Q[$]=U}}),Q}function RX(X){return X.split(`
`).length}function NX(X){let Z=X.split(`
`);return Z[Z.length-1]||""}function TX(X,Z,J){let Q=X.split(`
`),K=0,G=0,Y=0,$=0,U="",H=J.trim().replace(/\s+/g," "),F=[`${Z}: ${J}`,`${Z}:${J}`,`${Z}: ${H}`,`${Z}:${H}`];for(let z=0;z<Q.length;z++){let W=Q[z];if(!W)continue;for(let A of F){let q=W.indexOf(A);if(q!==-1)return U=A,K=z,G=q,Y=z,$=q+U.length,{startLine:K,startColumn:G,endLine:Y,endColumn:$,text:U}}let P=new RegExp(`${Z.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\s*:\\s*${J.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\s+/g,"\\s+")}`,"i"),B=W.match(P);if(B&&B.index!==void 0)return U=B[0],K=z,G=B.index,Y=z,$=B.index+U.length,{startLine:K,startColumn:G,endLine:Y,endColumn:$,text:U}}return{startLine:K,startColumn:G,endLine:Y,endColumn:$,text:U}}function r(X,Z){let{selectorText:J,style:Q,styleSheetId:K}=Z,G=J.split(",").map((H)=>H.trim()).filter((H)=>H.length>0),Y=n(Q),$=R(Q),U=[];if(G.forEach((H,F)=>{try{if(KX(X,H))U.push(F)}catch{}}),U.length===0&&G.length>0)G.forEach((H,F)=>U.push(F));return{matchingSelectors:U,rule:{styleSheetId:K,origin:"regular",selectorList:{selectors:G.map((H)=>({text:H})),text:J},style:{cssProperties:S($),shorthandEntries:Y}}}}function kX(X,Z){let J=X.split(`
`),Q=0,K=0;for(let G=0;G<=Z.endLine;G++){let $=(J[G]||"").length+1;if(G<Z.startLine)Q+=$;else if(G===Z.startLine)Q+=Z.startColumn;if(G<Z.endLine)K+=$;else if(G===Z.endLine)K+=Z.endColumn}return{start:Q,end:K}}class I extends D{namespace="CSS";styleSheetObserver=null;processedStyleSheets=new WeakSet;constructor(X){super(X)}validateElementNode(X){let Z=O(X);if(!Z)return null;if(Z.nodeType!==Node.ELEMENT_NODE)return null;if(!document.contains(Z))return null;return Z}sendStyleSheetAdded(X){if(this.processedStyleSheets.has(X))return;this.processedStyleSheets.add(X);let Z=x(X),J=X.href||"",Q=!J;this.send({method:V.styleSheetAdded,params:{header:{styleSheetId:Z,frameId:"main-frame",isInline:Q,sourceURL:Q?void 0:J,origin:"regular",startColumn:0,startLine:0,endColumn:0,endLine:0}}})}enable(){let X=GX();if(Array.from(X).forEach((Z)=>{this.sendStyleSheetAdded(Z)}),this.styleSheetObserver=new MutationObserver((Z)=>{Z.forEach((J)=>{J.addedNodes.forEach((Q)=>{if(Q.nodeType===Node.ELEMENT_NODE){let K=Q;if(K.tagName==="STYLE"||K.tagName==="LINK"&&K.getAttribute("rel")==="stylesheet")setTimeout(()=>{let G=GX();Array.from(G).forEach((Y)=>{if(!this.processedStyleSheets.has(Y))this.sendStyleSheetAdded(Y)})},0)}})})}),this.styleSheetObserver.observe(document.head,{childList:!0,subtree:!0}),document.body)this.styleSheetObserver.observe(document.body,{childList:!0,subtree:!0})}disable(){if(this.styleSheetObserver)this.styleSheetObserver.disconnect(),this.styleSheetObserver=null}getComputedStyleForNode({nodeId:X}){let Z=this.validateElementNode(X);if(!Z)return{computedStyle:[]};let J=window.getComputedStyle(Z),Q=R(J);return{computedStyle:S(Q)}}getInlineStylesForNode({nodeId:X}){let Z=this.validateElementNode(X);if(!Z)return{};let Q=Z.style,K={cssProperties:[],shorthandEntries:[]};if(Q&&Q.length>0){let G=MX(X);K.styleSheetId=G;let Y=Z.getAttribute("style")||"";if(K.cssText=Y,Y)K.range={startLine:0,startColumn:0,endLine:RX(Y)-1,endColumn:NX(Y).length};let $=xX(Y),U=S($).map(({name:W,value:P})=>{let B=TX(Y,W,P),A=Q[W],q=A!==void 0&&A!=="";return{name:W,value:P,text:B.text,range:{startLine:B.startLine,endLine:B.endLine,startColumn:B.startColumn,endColumn:B.endColumn},disabled:!1,implicit:!1,parsedOk:q}}),H=R(Q),F=new Set(U.map((W)=>W.name)),z=S(Object.fromEntries(Object.entries(H).filter(([W])=>!F.has(W))));K.shorthandEntries=n(Q),K.cssProperties=[...U,...z]}return{inlineStyle:K}}collectInheritedStyles(X){let Z=[],J=X.parentElement;while(J&&J!==document.documentElement){let Q=_(J);if(Q){let G=a(J).map(($)=>r(J,$)),Y=this.getInlineStylesForNode({nodeId:Q});if(G.length>0||Y.inlineStyle)Z.push({inlineStyle:Y.inlineStyle,matchedCSSRules:G})}J=J.parentElement}if(document.documentElement&&document.documentElement!==X){let Q=_(document.documentElement);if(Q){let G=a(document.documentElement).map(($)=>r(document.documentElement,$)),Y=this.getInlineStylesForNode({nodeId:Q});if(G.length>0||Y.inlineStyle)Z.push({inlineStyle:Y.inlineStyle,matchedCSSRules:G})}}return Z}getMatchedStylesForNode({nodeId:X}){let Z=this.validateElementNode(X);if(!Z)return{matchedCSSRules:[]};let Q=a(Z).map((Y)=>r(Z,Y)),K=this.getInlineStylesForNode({nodeId:X}),G=this.collectInheritedStyles(Z);return{matchedCSSRules:Q,...K,inherited:G.length>0?G:void 0}}getBackgroundColors({nodeId:X}){let Z=this.validateElementNode(X);if(!Z)return{backgroundColors:[]};let J=window.getComputedStyle(Z),Q=R(J);return{backgroundColors:Q["background-color"]?[Q["background-color"]]:[],computedFontSize:Q["font-size"],computedFontWeight:Q["font-weight"]}}async getStyleSheetText({styleSheetId:X}){let Z=d(X);if(Z){let Q=O(Z);if(Q&&Q.nodeType===Node.ELEMENT_NODE)return{text:Q.getAttribute("style")||""}}for(let Q=0;Q<document.styleSheets.length;Q++){let K=document.styleSheets[Q];if(!K)continue;if(x(K)===X){if(!K.href)try{let $=K.cssRules;if($)return{text:Array.from($).map((H)=>H.cssText).join(`
`)}}catch{return{text:""}}}}return{text:await EX(X)}}setStyleTexts({edits:X}){return{styles:X.map((J)=>{let{styleSheetId:Q,text:K,range:G}=J,Y=d(Q);if(Y){let $=O(Y);if($&&$.nodeType===Node.ELEMENT_NODE){let U=$,H=U.getAttribute("style")||"";if(G){let{start:z,end:W}=kX(H,G);H=H.slice(0,z)+K+H.slice(W)}else H=K;U.setAttribute("style",H);let F=this.getInlineStylesForNode({nodeId:Y}).inlineStyle;if(F&&F.styleSheetId)return{styleSheetId:F.styleSheetId,cssText:F.cssText,range:F.range,cssProperties:F.cssProperties,shorthandEntries:F.shorthandEntries};return{styleSheetId:Q}}}return{styleSheetId:Q}})}}}function bX(X){if(!X||typeof X!=="string")return"";let Z=document.createElement("a");return Z.href=X,Z.href}function SX(X){return X.replace(/^\S|-[a-z]/g,(Z)=>Z.toUpperCase())}var w=()=>Date.now()/1000;class f extends D{namespace="Network";requestId=0;responseData=new Map;xhrMetadata=new WeakMap;constructor(X){super(X);this.hookXhr(),this.hookFetch()}enable(){this.reportImageNetwork()}getResponseBody({requestId:X}){let Z=this.responseData.get(X);if(!Z)return{body:"",base64Encoded:!1};if(typeof Z.body==="string")return{body:Z.body,base64Encoded:!1};return{body:"",base64Encoded:!1}}getCookies(){let X=[];if(document.cookie)document.cookie.split(";").forEach((Z)=>{let[J,Q]=Z.split("=").map((K)=>K.trim());if(J&&Q)X.push({name:J,value:Q,domain:location.hostname,path:"/"})});return{cookies:X}}setCookie({name:X,value:Z,domain:J,path:Q,httpOnly:K,secure:G,sameSite:Y}){try{let $=`${X}=${Z}`;if(J)$+=`; domain=${J}`;if(Q)$+=`; path=${Q}`;if(K)$+="; httpOnly";if(G)$+="; secure";if(Y)$+=`; sameSite=${Y}`;return document.cookie=$,{success:!0}}catch{return{success:!1}}}deleteCookies({name:X,domain:Z,path:J}){if(X)document.cookie=`${X}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${J||"/"}; domain=${Z||location.hostname}`;else document.cookie.split(";").forEach((Q)=>{let K=Q.split("=")[0]?.trim();if(K)document.cookie=`${K}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`})}hookXhr(){let X=this,Z=XMLHttpRequest.prototype.open,J=XMLHttpRequest.prototype.send,Q=XMLHttpRequest.prototype.setRequestHeader;XMLHttpRequest.prototype.open=function(K,G,...Y){return X.xhrMetadata.set(this,{method:K,url:typeof G==="string"?G:G.toString(),headers:{}}),Z.apply(this,[K,G,...Y])},XMLHttpRequest.prototype.setRequestHeader=function(K,G){let Y=X.xhrMetadata.get(this);if(Y)Y.headers=Y.headers||{},Y.headers[K]=G;return Q.apply(this,[K,G])},XMLHttpRequest.prototype.send=function(K){let G=X.xhrMetadata.get(this);if(!G)return J.apply(this,[K]);let{method:Y,url:$,headers:U={}}=G,H=`${X.requestId++}`,F={...f.getDefaultHeaders(),...U},z={requestId:H,url:$,method:Y,headers:F};if(K)z.postData=typeof K==="string"?K:JSON.stringify(K);return X.socketSend({method:V.requestWillBeSent,params:{requestId:H,loaderId:H,documentURL:location.href,request:{url:$,method:Y,headers:z.headers,postData:z.postData},timestamp:w(),type:"XHR"}}),this.addEventListener("load",()=>{let W={requestId:H,url:$,status:this.status,statusText:this.statusText,headers:f.formatResponseHeader(this.getAllResponseHeaders()),mimeType:this.getResponseHeader("content-type")||"text/plain",body:this.responseText};X.responseData.set(H,W),X.socketSend({method:V.responseReceived,params:{requestId:H,loaderId:H,timestamp:w(),type:"XHR",response:{url:$,status:this.status,statusText:this.statusText,headers:W.headers,mimeType:W.mimeType,body:W.body}}});let P=this.getResponseHeader("content-length"),B=f.calculateEncodedDataLength(P,this.responseText);X.socketSend({method:V.loadingFinished,params:{requestId:H,timestamp:w(),encodedDataLength:B}})}),this.addEventListener("error",()=>{X.socketSend({method:V.loadingFailed,params:{requestId:H,timestamp:w(),errorText:"Network error",canceled:!1}})}),J.apply(this,[K])}}hookFetch(){let X=this,Z=window.fetch;window.fetch=function(J,Q){let K=typeof J==="string"?J:J instanceof URL?J.toString():J.url,G=Q?.method||"GET",Y=`${X.requestId++}`,$=f.getDefaultHeaders();if(Q?.headers)if(Q.headers instanceof Headers)Q.headers.forEach((H,F)=>{$[F]=H});else if(Array.isArray(Q.headers))Q.headers.forEach(([H,F])=>{$[H]=F});else $={...$,...Q.headers};if(J instanceof Request&&J.headers)J.headers.forEach((H,F)=>{$[F]=H});let U={requestId:Y,url:K,method:G,headers:$};if(Q?.body)U.postData=typeof Q.body==="string"?Q.body:JSON.stringify(Q.body);return X.socketSend({method:V.requestWillBeSent,params:{requestId:Y,loaderId:Y,documentURL:location.href,request:{url:K,method:G,headers:U.headers,postData:U.postData},timestamp:w(),type:"Fetch"}}),Z(J,Q).then((H)=>{let F=H.clone(),z="";return H.headers.forEach((W,P)=>{z+=`${P}: ${W}\r
`}),F.text().then((W)=>{let P={requestId:Y,url:K,status:H.status,statusText:H.statusText,headers:f.formatResponseHeader(z),mimeType:H.headers.get("content-type")||"text/plain",body:W};X.responseData.set(Y,P),X.socketSend({method:V.responseReceived,params:{requestId:Y,loaderId:Y,timestamp:w(),type:"Fetch",response:{url:K,status:H.status,statusText:H.statusText,headers:P.headers,mimeType:P.mimeType,body:P.body}}});let B=H.headers.get("content-length"),A=f.calculateEncodedDataLength(B,W);X.socketSend({method:V.loadingFinished,params:{requestId:Y,timestamp:w(),encodedDataLength:A}})}).catch((W)=>{console.warn("Failed to read response body / 응답 본문 읽기 실패:",W);let P={requestId:Y,url:K,status:H.status,statusText:H.statusText,headers:f.formatResponseHeader(z),mimeType:H.headers.get("content-type")||"text/plain",body:""};X.responseData.set(Y,P),X.socketSend({method:V.responseReceived,params:{requestId:Y,loaderId:Y,timestamp:w(),type:"Fetch",response:{url:K,status:H.status,statusText:H.statusText,headers:P.headers,mimeType:P.mimeType,body:""}}}),X.socketSend({method:V.loadingFinished,params:{requestId:Y,timestamp:w(),encodedDataLength:0}})}),H}).catch((H)=>{throw X.socketSend({method:V.loadingFailed,params:{requestId:Y,timestamp:w(),errorText:H.message,canceled:!1}}),H})}}reportImageNetwork(){document.querySelectorAll("img").forEach((Z)=>{if(Z.src&&!Z.complete){let J=`${this.requestId++}`;this.socketSend({method:V.requestWillBeSent,params:{requestId:J,loaderId:J,documentURL:location.href,request:{url:Z.src,method:"GET",headers:f.getDefaultHeaders()},timestamp:w(),type:"Image"}}),Z.addEventListener("load",()=>{this.socketSend({method:V.responseReceived,params:{requestId:J,loaderId:J,timestamp:w(),type:"Image",response:{url:Z.src,status:200,statusText:"OK",headers:{},mimeType:"image/*",body:void 0}}}),this.socketSend({method:V.loadingFinished,params:{requestId:J,timestamp:w(),encodedDataLength:0}})}),Z.addEventListener("error",()=>{this.socketSend({method:V.loadingFailed,params:{requestId:J,timestamp:w(),errorText:"Failed to load image",canceled:!1}})})}})}socketSend(X){this.send(X)}static formatResponseHeader(X){let Z={},J=X.split(`
`);for(let Q of J){let K=Q.trim();if(K==="")continue;let[G,Y]=K.split(":",2);if(G)Z[SX(G.trim())]=Y?Y.trim():""}return Z}static getDefaultHeaders(){let X={"User-Agent":navigator.userAgent};if(document.cookie)X.Cookie=document.cookie;return X}static calculateEncodedDataLength(X,Z){if(X){let J=parseInt(X,10);if(!isNaN(J)&&J>=0)return J}return new Blob([Z]).size}}class y extends D{namespace="Console";isEnable=!1;enable(){this.isEnable=!0}clearMessages(){}}class yX{listeners=new Map;originalMethods=new WeakMap;subscribe(X,Z){if(!this.listeners.has(X))this.listeners.set(X,new Set),this.hookStorage(X);return this.listeners.get(X).add(Z),()=>{let J=this.listeners.get(X);if(J){if(J.delete(Z),J.size===0)this.unhookStorage(X),this.listeners.delete(X)}}}hookStorage(X){if(this.originalMethods.has(X))return;let Z=X.setItem.bind(X),J=X.removeItem.bind(X),Q=X.clear.bind(X);this.originalMethods.set(X,{setItem:Z,removeItem:J,clear:Q}),X.setItem=(K,G)=>{let Y=this.originalMethods.get(X);if(!Y)return;let $=X.getItem(K),U=$!==null;Y.setItem(K,G),this.notify(X,{type:U?"updated":"added",key:K,oldValue:$,newValue:G})},X.removeItem=(K)=>{let G=this.originalMethods.get(X);if(!G)return;let Y=X.getItem(K);if(Y!==null)G.removeItem(K),this.notify(X,{type:"removed",key:K,oldValue:Y,newValue:null})},X.clear=()=>{let K=this.originalMethods.get(X);if(!K)return;K.clear(),this.notify(X,{type:"cleared",key:null,oldValue:null,newValue:null})}}unhookStorage(X){let Z=this.originalMethods.get(X);if(Z)X.setItem=Z.setItem,X.removeItem=Z.removeItem,X.clear=Z.clear,this.originalMethods.delete(X)}notify(X,Z){let J=this.listeners.get(X);if(J)J.forEach((Q)=>{try{Q(Z)}catch{}})}}var IX=new yX;class h extends D{namespace="DOMStorage";isEnable=!1;unsubscribeFunctions=[];enable(){if(this.isEnable)return;this.isEnable=!0,this.setupStorageListeners();let X=location.origin,Z={isLocalStorage:!0,storageKey:X,securityOrigin:X},J={isLocalStorage:!1,storageKey:X,securityOrigin:X};this.getDOMStorageItems({storageId:Z}).entries.forEach(([G,Y])=>{this.send({method:V.domStorageItemAdded,params:{storageId:Z,key:G,newValue:Y}})}),this.getDOMStorageItems({storageId:J}).entries.forEach(([G,Y])=>{this.send({method:V.domStorageItemAdded,params:{storageId:J,key:G,newValue:Y}})})}disable(){if(!this.isEnable)return;this.isEnable=!1,this.removeStorageListeners()}getDOMStorageItems({storageId:X}){let Z=X.isLocalStorage?localStorage:sessionStorage,J=[];for(let Q=0;Q<Z.length;Q++){let K=Z.key(Q);if(K!==null){let G=Z.getItem(K);if(G!==null)J.push([K,G])}}return{entries:J}}setDOMStorageItem({storageId:X,key:Z,value:J}){(X.isLocalStorage?localStorage:sessionStorage).setItem(Z,J)}removeDOMStorageItem({storageId:X,key:Z}){(X.isLocalStorage?localStorage:sessionStorage).removeItem(Z)}clear({storageId:X}){(X.isLocalStorage?localStorage:sessionStorage).clear()}setupStorageListeners(){let X=IX.subscribe(localStorage,(J)=>{if(!this.isEnable)return;let Q={isLocalStorage:!0,storageKey:location.origin,securityOrigin:location.origin};this.handleStorageChange(Q,J)}),Z=IX.subscribe(sessionStorage,(J)=>{if(!this.isEnable)return;let Q={isLocalStorage:!1,storageKey:location.origin,securityOrigin:location.origin};this.handleStorageChange(Q,J)});this.unsubscribeFunctions.push(X,Z)}handleStorageChange(X,Z){if(!this.isEnable)return;let J=null;switch(Z.type){case"added":if(Z.key===null||Z.newValue===null)return;J={method:V.domStorageItemAdded,params:{storageId:X,key:Z.key,newValue:Z.newValue}};break;case"updated":if(Z.key===null||Z.oldValue===null||Z.newValue===null)return;J={method:V.domStorageItemUpdated,params:{storageId:X,key:Z.key,oldValue:Z.oldValue,newValue:Z.newValue}};break;case"removed":if(Z.key===null)return;J={method:V.domStorageItemRemoved,params:{storageId:X,key:Z.key}};break;case"cleared":J={method:V.domStorageItemsCleared,params:{storageId:X}};break;default:return}if(J)this.send(J)}removeStorageListeners(){this.unsubscribeFunctions.forEach((X)=>X()),this.unsubscribeFunctions=[]}}class v extends D{namespace="Storage";getStorageKey(X){return{storageKey:location.origin}}async replayStoredEvents(){if(!this.eventStorage||!this.socket)return console.warn("Cannot replay stored messages: eventStorage or socket not available / 저장된 메시지 재생 불가: eventStorage 또는 socket이 사용 불가"),{success:!1};try{let X=await this.eventStorage.getEvents();if(X.length===0)return{success:!0,count:0};let Z=X.filter((K)=>{try{return!(JSON.parse(K.message).method||"").startsWith("SessionReplay.")}catch{return!0}});if(Z.length===0)return{success:!0,count:0};let J=100,Q=0;for(let K=0;K<Z.length;K+=J){let G=Z.slice(K,K+J);for(let Y of G)if(this.socket.readyState===WebSocket.OPEN)try{let $=JSON.parse(Y.message);this.socket.send(JSON.stringify($)),Q++}catch($){console.warn("Failed to parse stored message / 저장된 메시지 파싱 실패:",$)}else console.warn("WebSocket not open, cannot send message / WebSocket이 열려있지 않아 메시지 전송 불가");await new Promise((Y)=>setTimeout(Y,10))}return{success:!0,count:Q}}catch(X){return console.error("Failed to replay stored messages / 저장된 메시지 재생 실패:",X),{success:!1}}}}class g extends D{namespace="SessionReplay";isEnabled=!1;constructor(X){super(X)}enable(){this.isEnabled=!0,this.replayStoredEvents().catch((X)=>{console.error("Failed to replay stored SessionReplay events / 저장된 SessionReplay 이벤트 재생 실패:",X)})}setDevToolsWindow(X){if(this.devtoolsWindow=X,this.isEnabled)this.replayStoredEvents().then(()=>{super.setDevToolsWindow(X)}).catch((Z)=>{console.error("Failed to replay stored SessionReplay events after DevTools ready / DevTools 준비 후 저장된 SessionReplay 이벤트 재생 실패:",Z),super.setDevToolsWindow(X)});else super.setDevToolsWindow(X)}disable(){this.isEnabled=!1}sendEvent(X){if(!this.isEnabled)return{success:!1};let Z=X?.events||[];if(Z.length===0)return{success:!1};return this.send({method:V.sessionReplayEventRecorded,params:{events:Z}}),{success:!0}}async replayStoredEvents(){if(!this.eventStorage)return{success:!1};try{let Z=(await this.eventStorage.getEvents()).filter((Q)=>{try{return JSON.parse(Q.message).method==="SessionReplay.eventRecorded"}catch{return!1}});if(Z.length===0)return{success:!0,count:0};let J=0;for(let Q of Z)try{let K=JSON.parse(Q.message),G=K.params;if(G&&Array.isArray(G.events)&&G.events.length>0){if(this.socket&&this.socket.readyState===WebSocket.OPEN)this.socket.send(JSON.stringify(K)),J++;else if(!this.socket)if(this.devtoolsWindow)try{this.devtoolsWindow.postMessage(Q,"*"),J++}catch(Y){console.warn("[SessionReplay] Failed to send event via postMessage / [SessionReplay] postMessage로 이벤트 전송 실패:",Y)}else return{success:!1};await new Promise((Y)=>setTimeout(Y,10))}else console.warn("[SessionReplay] Event params invalid or empty events array / [SessionReplay] 이벤트 params가 유효하지 않거나 events 배열이 비어있음:",G)}catch(K){console.warn("[SessionReplay] Failed to parse stored message / [SessionReplay] 저장된 메시지 파싱 실패:",K)}return{success:!0,count:J}}catch(X){return console.error("Failed to replay stored events / 저장된 이벤트 재생 실패:",X),{success:!1}}}}class p{protocol={};domains=[];eventStorage;constructor(X){this.eventStorage=X.eventStorage,this.registerProtocol(X)}setDevToolsWindow(X){this.domains.forEach((Z)=>{Z.setDevToolsWindow(X)})}execute(X={}){let{id:Z,method:J,params:Q}=X;if(!J)return{id:Z};if(this.eventStorage)this.eventStorage.saveMessage({id:Z,method:J,params:Q});let K=this.protocol[J];if(typeof K!=="function")return{id:Z};try{let G=K(Q);if(G instanceof Promise)return G.then((Y)=>({id:Z,result:Y})).catch((Y)=>({id:Z,error:{code:-32000,message:Y instanceof Error?Y.message:String(Y)}}));return{id:Z,result:G}}catch(G){return{id:Z,error:{code:-32000,message:G instanceof Error?G.message:String(G)}}}}registerProtocol(X){let Z=[new Runtime(X),new b(X),new E(X),new I(X),new f(X),new y(X),new h(X),new v(X),new g(X)];this.domains=Z,Z.forEach((J)=>{let{namespace:Q}=J,K=ZX[Q];if(K)K.forEach((G)=>{let Y=`${Q}.${G}`,$=J[G];if(typeof $==="function")this.protocol[Y]=$.bind(J)})})}getEventStorage(){return this.eventStorage}}var KZ="CDPEventStorage",GZ=1,L="events",C="clientActivity",FX=86400000;class zX{db=null;config;clientId;maxSize=52428800;maxEvents=1e4;constructor(X){if(!X.clientId)throw Error("clientId is required / clientId는 필수입니다");if(this.config=X,this.clientId=X.clientId,this.maxEvents=X.maxStoredEvents||1e4,X.maxStorageSize)this.maxSize=X.maxStorageSize;else this.calculateMaxSize()}async init(){return new Promise((X,Z)=>{let J=indexedDB.open(KZ,GZ);J.onerror=()=>{console.error("Failed to open IndexedDB / IndexedDB 열기 실패:",J.error),Z(J.error)},J.onsuccess=()=>{this.db=J.result,X()},J.onupgradeneeded=(Q)=>{let K=Q.target.result,G=Q.target.transaction;if(!G)return;let Y;if(!K.objectStoreNames.contains(L))Y=K.createObjectStore(L,{keyPath:"id",autoIncrement:!0}),Y.createIndex("timestamp","timestamp",{unique:!1});else Y=G.objectStore(L);if(!Y.indexNames.contains("clientId"))Y.createIndex("clientId","clientId",{unique:!1});if(!Y.indexNames.contains("clientId_timestamp"))Y.createIndex("clientId_timestamp",["clientId","timestamp"],{unique:!1});if(!K.objectStoreNames.contains(C))K.createObjectStore(C,{keyPath:"clientId"}).createIndex("lastActiveTime","lastActiveTime",{unique:!1})}})}async calculateMaxSize(){if(typeof navigator>"u"||!navigator.storage||!navigator.storage.estimate)return;try{let X=await navigator.storage.estimate(),Z=(X.quota||0)-(X.usage||0);this.maxSize=Math.min(Z*0.5,52428800)}catch(X){console.warn("Failed to estimate storage quota / 저장 용량 확인 실패:",X)}}shouldStore(X){if(typeof X!=="object"||X===null)return!1;return"method"in X||"id"in X}async getCurrentSize(){if(!this.db)return 0;return new Promise((X,Z)=>{let G=this.db.transaction([L],"readonly").objectStore(L).index("clientId").getAll(this.clientId);G.onsuccess=()=>{let $=G.result.reduce((U,H)=>U+(H.size||0),0);X($)},G.onerror=()=>{Z(G.error)}})}async getEventCount(){if(!this.db)return 0;return new Promise((X,Z)=>{let G=this.db.transaction([L],"readonly").objectStore(L).index("clientId").count(this.clientId);G.onsuccess=()=>{X(G.result)},G.onerror=()=>{Z(G.error)}})}async deleteOldEvents(X){if(!this.db)return;return new Promise((Z,J)=>{let G=this.db.transaction([L],"readwrite").objectStore(L).index("clientId_timestamp"),Y=IDBKeyRange.bound([this.clientId,0],[this.clientId,1/0]),$=G.openCursor(Y,"next"),U=0;$.onsuccess=(H)=>{let F=H.target.result;if(F&&U<X){let z=F.value;U+=z.size||0,F.delete(),F.continue()}else Z()},$.onerror=()=>{J($.error)}})}async deleteOldEventsByCount(X){if(!this.db)return;return new Promise((Z,J)=>{let G=this.db.transaction([L],"readwrite").objectStore(L).index("clientId_timestamp"),Y=IDBKeyRange.bound([this.clientId,0],[this.clientId,1/0]),$=G.openCursor(Y,"next"),U=0;$.onsuccess=(H)=>{let F=H.target.result;if(F&&U<X)F.delete(),U++,F.continue();else Z()},$.onerror=()=>{J($.error)}})}async ensureStorageSpace(X){let Z=await this.getCurrentSize(),J=await this.getEventCount();if(Z+X>this.maxSize||J>=this.maxEvents){let Q=Math.max(0,Z+X-this.maxSize),K=J>=this.maxEvents?J-this.maxEvents+1:0;if(K>0)await this.deleteOldEventsByCount(K);else if(Q>0)await this.deleteOldEvents(Q)}}async saveMessage(X,Z=0){if(!this.shouldStore(X))return;if(!this.db)await this.init();if(!this.db){console.warn("IndexedDB not available / IndexedDB 사용 불가");return}try{let J=Date.now(),Q,K=!1,G,Y=JSON.stringify(X);if(G=new Blob([Y]).size,this.config.enableCompression){let $=await HX(Y);if($)Q=JSON.stringify({compressed:!0,data:Array.from(new Uint8Array($))}),K=!0,G=$.byteLength;else Q=Y}else Q=Y;return await this.ensureStorageSpace(G),new Promise(($)=>{let H=this.db.transaction([L],"readwrite").objectStore(L),F={clientId:this.clientId,type:"CDP_MESSAGE",message:Q,timestamp:J,compressed:K,size:G},z=H.add(F);z.onsuccess=()=>{$()},z.onerror=()=>{if(z.error?.name==="QuotaExceededError"&&Z<1)this.deleteOldEvents(G).then(()=>{this.saveMessage(X,Z+1).then($).catch(()=>{$()})});else console.error("Failed to save message / 메시지 저장 실패:",z.error),$()}})}catch(J){console.error("Error saving message / 메시지 저장 오류:",J)}}async saveEvent(X,Z,J=0){return this.saveMessage({method:X,params:Z},J)}async getEvents(){if(!this.db)await this.init();if(!this.db)return[];return new Promise((X,Z)=>{let K=this.db.transaction([L],"readonly").objectStore(L).index("clientId_timestamp"),G=IDBKeyRange.bound([this.clientId,0],[this.clientId,1/0]),Y=K.getAll(G);Y.onsuccess=async()=>{let $=Y.result,U=await Promise.all($.map(async(H)=>{let F;if(H.compressed){let{decompress:z}=await Promise.resolve().then(() => UX),W=new Uint8Array(JSON.parse(H.message).data).buffer,P=await z(W);if(P)try{let B=JSON.parse(P);if(B&&typeof B==="object"&&"message"in B&&B.type==="CDP_MESSAGE")F=B.message;else F=P}catch{F=P}else F=H.message}else try{let z=JSON.parse(H.message);if(z&&typeof z==="object"&&"message"in z&&z.type==="CDP_MESSAGE")F=z.message;else F=H.message}catch{F=H.message}return{type:"CDP_MESSAGE",message:F}}));X(U)},Y.onerror=()=>{Z(Y.error)}})}async getEventsAfter(X){if(!this.db)await this.init();if(!this.db)return[];return new Promise((Z,J)=>{let G=this.db.transaction([L],"readonly").objectStore(L).index("clientId_timestamp"),Y=IDBKeyRange.bound([this.clientId,X],[this.clientId,1/0],!0,!1),$=G.getAll(Y);$.onsuccess=async()=>{let U=$.result,H=await Promise.all(U.map(async(F)=>{let z;if(F.compressed){let{decompress:W}=await Promise.resolve().then(() => UX),P=new Uint8Array(JSON.parse(F.message).data).buffer,B=await W(P);if(B)try{let A=JSON.parse(B);if(A&&typeof A==="object"&&"message"in A&&A.type==="CDP_MESSAGE")z=A.message;else z=B}catch{z=B}else z=F.message}else try{let W=JSON.parse(F.message);if(W&&typeof W==="object"&&"message"in W&&W.type==="CDP_MESSAGE")z=W.message;else z=F.message}catch{z=F.message}return{type:"CDP_MESSAGE",message:z}}));Z(H)},$.onerror=()=>{J($.error)}})}async clearEvents(X){if(!this.db)return;return new Promise((Z,J)=>{let Y=this.db.transaction([L],"readwrite").objectStore(L).index("clientId").openCursor(IDBKeyRange.only(this.clientId));Y.onsuccess=($)=>{let U=$.target.result;if(U){let H=U.value;if(X)try{let z=JSON.parse(H.message).method||"";if(X.some((W)=>z.startsWith(W))){U.continue();return}}catch{}U.delete(),U.continue()}else Z()},Y.onerror=()=>{J(Y.error)}})}async clearEventsBefore(X){if(!this.db)return;return new Promise((Z,J)=>{let G=this.db.transaction([L],"readwrite").objectStore(L).index("clientId_timestamp"),Y=IDBKeyRange.bound([this.clientId,0],[this.clientId,X],!1,!0),$=G.openCursor(Y);$.onsuccess=(U)=>{let H=U.target.result;if(H)H.delete(),H.continue();else Z()},$.onerror=()=>{J($.error)}})}async updateLastActiveTime(){if(!this.db)await this.init();if(!this.db)return;return new Promise((X,Z)=>{let Q=this.db.transaction([C],"readwrite").objectStore(C),K={clientId:this.clientId,lastActiveTime:Date.now()},G=Q.put(K);G.onsuccess=()=>{X()},G.onerror=()=>{Z(G.error)}})}async getActiveClientIds(){if(!this.db)await this.init();if(!this.db)return new Set;return new Promise((X,Z)=>{let K=this.db.transaction([C],"readonly").objectStore(C).index("lastActiveTime"),G=Date.now()-FX,Y=IDBKeyRange.lowerBound(G),$=K.getAll(Y);$.onsuccess=()=>{let U=$.result,H=new Set(U.map((F)=>F.clientId));X(H)},$.onerror=()=>{Z($.error)}})}async cleanupOrphanedEvents(){if(!this.db)await this.init();if(!this.db)return 0;try{let X=await this.getActiveClientIds(),Z=Date.now()-FX;return new Promise((J,Q)=>{let Y=this.db.transaction([L],"readwrite").objectStore(L).index("timestamp"),$=IDBKeyRange.upperBound(Z),U=Y.openCursor($),H=0;U.onsuccess=(F)=>{let z=F.target.result;if(z){let W=z.value;if(!X.has(W.clientId))z.delete(),H++;z.continue()}else this.cleanupOldActivityRecords().then(()=>{J(H)})},U.onerror=()=>{Q(U.error)}})}catch(X){return console.error("Failed to cleanup orphaned events / orphaned 이벤트 정리 실패:",X),0}}async cleanupOldActivityRecords(){if(!this.db)return;return new Promise((X,Z)=>{let K=this.db.transaction([C],"readwrite").objectStore(C).index("lastActiveTime"),G=Date.now()-FX,Y=IDBKeyRange.upperBound(G),$=K.openCursor(Y);$.onsuccess=(U)=>{let H=U.target.result;if(H)H.delete(),H.continue();else X()},$.onerror=()=>{Z($.error)}})}async exportToFile(){if(!this.db)await this.init();if(!this.db)throw Error("IndexedDB not available / IndexedDB 사용 불가");try{let X=await this.getEvents(),Z=[];if(document.cookie)document.cookie.split(";").forEach((z)=>{let W=z.indexOf("=");if(W>0){let P=z.substring(0,W).trim(),B=z.substring(W+1).trim();if(P&&B)Z.push({name:P,value:B,domain:location.hostname,path:"/"})}});let J=[],Q=[];for(let z=0;z<window.localStorage.length;z++){let W=window.localStorage.key(z);if(W){let P=window.localStorage.getItem(W);if(P!==null)J.push([W,P])}}for(let z=0;z<window.sessionStorage.length;z++){let W=window.sessionStorage.key(z);if(W){let P=window.sessionStorage.getItem(W);if(P!==null)Q.push([W,P])}}let K=document.documentElement.outerHTML,G={documentURL:document.URL||location.href,baseURL:document.baseURI||location.href,html:K},Y={version:"1.0.0",exportDate:new Date().toISOString(),clientId:this.clientId,events:X,cookies:Z,localStorage:J,sessionStorage:Q,domTree:G},$=JSON.stringify(Y,null,2),U=new Blob([$],{type:"application/json"}),H=URL.createObjectURL(U),F=document.createElement("a");F.href=H,F.download=`cdp-events-${this.clientId}-${Date.now()}.json`,F.click(),URL.revokeObjectURL(H)}catch(X){throw console.error("Failed to export messages / 메시지 내보내기 실패:",X),X}}}function m(){let X=sessionStorage.getItem("debug_id");if(!X){if(typeof crypto<"u"&&crypto.randomUUID)X=crypto.randomUUID();else{let Z=`${Date.now()}-${performance.now()}`,J=Math.random().toString(36).substring(2,11),Q=Math.random().toString(36).substring(2,11),K=Math.random().toString(36).substring(2,11);X=`${Z}-${J}-${Q}-${K}`}sessionStorage.setItem("debug_id",X)}return X}function YZ(){let X=document.head.querySelectorAll("link"),Z=Array.from(X).find((Q)=>{let K=Q.getAttribute("rel");return K?.includes("icon")||K?.includes("shortcut")}),J="";if(Z)J=bX(Z.getAttribute("href")||"");return J}function hX(){let X=new URLSearchParams;return X.append("url",location.href),X.append("title",document.title),X.append("favicon",YZ()),X.append("time",Date.now().toString()),X.append("ua",navigator.userAgent),X.toString()}class WX{serverUrl;rrwebConfig;skipWebSocket;onDomainCreated;onRrwebInit;socket=null;domain=null;eventStorage=void 0;updateInterval=null;cleanupInterval=null;constructor(X,Z,J,Q,K){this.serverUrl=X;this.rrwebConfig=Z;this.skipWebSocket=J;this.onDomainCreated=Q;this.onRrwebInit=K}async initialize(){if(await this.initializeEventStorage(),this.skipWebSocket){await this.initializePostMessageMode();return}await this.initializeWebSocket()}async initializePostMessageMode(){let X=new p({socket:null,eventStorage:this.eventStorage});if(this.domain=X,this.onDomainCreated?.(X),X.execute({method:"Runtime.enable"}),X.execute({method:"Network.enable"}),X.execute({method:"Console.enable"}),this.onRrwebInit)await this.onRrwebInit(null,X)}async initializeWebSocket(){let X="ws:";if(this.serverUrl.startsWith("wss://")||this.serverUrl.startsWith("https://"))X="wss:";else if(this.serverUrl.startsWith("ws://")||this.serverUrl.startsWith("http://"))X="ws:";else if(typeof location<"u"&&location.protocol==="https:")X="wss:";let Z=this.serverUrl.replace(/^(http|https|ws|wss):\/\//i,""),J=new WebSocket(`${X}//${Z}/remote/debug/client/${m()}?${hX()}`);this.socket=J;let Q=new p({socket:J,eventStorage:this.eventStorage});if(this.domain=Q,this.onDomainCreated?.(Q),this.setupSocketHandlers(J,Q),this.setupPeriodicTasks(J),this.onRrwebInit)await this.onRrwebInit(J,Q)}async initializeEventStorage(){let X=m(),Z=this.rrwebConfig.enableEventStorage!==!1,J=this.rrwebConfig.enableCompression!==!1;if(!Z)return;this.eventStorage=new zX({clientId:X,enableCompression:J,maxStoredEvents:this.rrwebConfig.maxStoredEvents,maxStorageSize:this.rrwebConfig.maxStorageSize}),await this.eventStorage.init().then(async()=>{if(performance.getEntriesByType("navigation")[0]?.type==="reload")await this.eventStorage?.clearEvents();if(await this.eventStorage?.updateLastActiveTime(),await this.eventStorage?.cleanupOrphanedEvents(),this.rrwebConfig.enableExportButton===!0&&this.eventStorage){let{injectExportButton:G}=await Promise.resolve().then(() => vX);G(this.eventStorage)}})}setupSocketHandlers(X,Z){X.addEventListener("message",async({data:J})=>{await this.handleSocketMessage(J,Z,X)})}async sendStoredEvents(X){if(!this.eventStorage||this.rrwebConfig.enableEventStorage===!1)return;try{let Z=await this.eventStorage.getEvents();if(Z.length>0)for(let Q=0;Q<Z.length;Q+=100){let K=Z.slice(Q,Q+100);for(let G of K)if(X.readyState===WebSocket.OPEN)try{let Y=JSON.parse(G.message);X.send(JSON.stringify(Y))}catch(Y){console.warn("Failed to parse stored message / 저장된 메시지 파싱 실패:",Y)}await new Promise((G)=>setTimeout(G,10))}}catch(Z){console.error("Failed to send stored messages / 저장된 메시지 전송 실패:",Z)}}async handleSocketMessage(X,Z,J){try{let Q;if(X instanceof Blob)Q=await X.text();else if(typeof X==="string")Q=X;else if(X instanceof ArrayBuffer)Q=new TextDecoder().decode(X);else Q=String(X);let K=JSON.parse(Q),G=Z.execute(K);if(G instanceof Promise){let Y=await G;if(Y.id!==void 0)J.send(JSON.stringify(Y))}else if(G.id!==void 0)J.send(JSON.stringify(G))}catch(Q){console.error("CDP message error:",Q)}}setupPeriodicTasks(X){if(this.rrwebConfig.enableEventStorage!==!1&&this.eventStorage)this.updateInterval=setInterval(async()=>{await this.eventStorage?.updateLastActiveTime()},300000),this.cleanupInterval=setInterval(async()=>{await this.eventStorage?.cleanupOrphanedEvents()},3600000),X.addEventListener("close",()=>{this.cleanup()})}getDomain(){return this.domain}getSocket(){return this.socket}cleanup(){if(this.updateInterval)clearInterval(this.updateInterval),this.updateInterval=null;if(this.cleanupInterval)clearInterval(this.cleanupInterval),this.cleanupInterval=null;if(this.socket&&this.socket.readyState!==WebSocket.CLOSED)this.socket.close();this.socket=null,this.domain=null}}class VX{domain;handler=null;devtoolsWindow=null;constructor(X){this.domain=X;this.setup()}setDomain(X){if(this.domain=X,this.devtoolsWindow&&X)X.setDevToolsWindow(this.devtoolsWindow)}setup(){this.handler=this.handleMessage.bind(this),window.addEventListener("message",this.handler)}isWindow(X){return X!==null&&typeof X==="object"&&"postMessage"in X&&typeof X.postMessage==="function"}handleMessage(X){if(!X.data||typeof X.data!=="object")return;if(typeof window<"u"&&window.__CHROME_REMOTE_DEVTOOLS_REPLAY_MODE__)return;if(X.data.type==="DEVTOOLS_READY"){if(this.isWindow(X.source)){if(this.devtoolsWindow=X.source,this.domain)this.domain.setDevToolsWindow(this.devtoolsWindow)}window.dispatchEvent(new CustomEvent("devtools-ready",{detail:{ready:!0}}));return}if(X.data.type==="CDP_MESSAGE"&&X.data.message){if(!this.devtoolsWindow&&this.isWindow(X.source)){if(this.devtoolsWindow=X.source,this.domain)this.domain.setDevToolsWindow(this.devtoolsWindow)}this.handleCDPMessage(X,!0);return}}handleCDPMessage(X,Z,J=!1){if(!this.domain)return;try{let Q=Z?JSON.parse(X.data.message):X.data,K=this.domain.execute(Q);this.sendResponse(X.source,Q.id,K,J)}catch(Q){console.warn("Failed to parse CDP message:",Q)}}sendResponse(X,Z,J,Q=!1){let K=(G)=>{if(G.id!==void 0&&this.isWindow(X))try{if(Q)X.postMessage(G,"*");else{let Y={type:"CDP_MESSAGE",message:JSON.stringify(G)};X.postMessage(Y,"*")}}catch(Y){console.warn("Failed to send postMessage response:",Y)}};if(J instanceof Promise)J.then(K).catch((G)=>{K({id:Z,error:{code:-32000,message:G instanceof Error?G.message:String(G)}})});else K(J)}destroy(){if(this.handler)window.removeEventListener("message",this.handler),this.handler=null}}var o=nX("@ohah/chrome-remote-devtools-client-rrweb");async function gX(X,Z,J){if(!Z.enable)return null;try{J.execute({method:"SessionReplay.enable"});let Q=Z.recordOptions??{},K=o.createDefaultCDPTransport({executeCDP:(Y,$)=>{let U=J.execute({method:Y,params:$});if(U instanceof Promise)return{error:{message:"Async method not supported in executeCDP"}};return{result:U.result,error:U.error}}}),G=o.initRrwebRecorder({transport:K,flushIntervalMs:Z.flushIntervalMs,maxBatchSize:Z.maxBatchSize,recordOptions:{checkoutEveryNth:200,checkoutEveryNms:5000,recordCanvas:!1,inlineStylesheet:!1,blockClass:"rr-block",blockSelector:'script, meta[http-equiv="refresh"], iframe',ignoreClass:"rr-ignore",maskAllInputs:!0,...Q},kind:"rrweb",onError:(Y)=>{console.warn("rrweb recorder error / rrweb 레코더 오류:",Y)}});if(await G.start(),X)X.addEventListener("close",()=>{G.stop()});return G}catch(Q){return console.error("Failed to start rrweb recorder / rrweb 레코더 시작 실패:",Q),null}}function pX(){let X=navigator;if(!X.wakeLock)return;X.wakeLock.request("screen").catch(()=>{}),document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible")X.wakeLock?.request("screen").catch(()=>{})})}class PX{domain=null;rrwebRecorder=null;websocketClient=null;postMessageHandler=null;async initialize(X,Z={enable:!1},J=!1){this.websocketClient=new WX(X,Z,J,(Q)=>{if(this.domain=Q,this.postMessageHandler)this.postMessageHandler.setDomain(Q)},async(Q,K)=>{this.rrwebRecorder=await gX(Q,Z,K)}),await this.websocketClient.initialize(),this.domain=this.websocketClient.getDomain(),this.postMessageHandler=new VX(this.domain),pX()}getDomain(){return this.domain}getRrwebRecorder(){return this.rrwebRecorder}getWebSocketClient(){return this.websocketClient}getPostMessageHandler(){return this.postMessageHandler}destroy(){if(this.websocketClient)this.websocketClient.cleanup(),this.websocketClient=null;if(this.postMessageHandler)this.postMessageHandler.destroy(),this.postMessageHandler=null;if(this.rrwebRecorder)this.rrwebRecorder.stop(),this.rrwebRecorder=null;this.domain=null}}var N=null;async function mX(X,Z={enable:!1},J=!1){if(N)N.destroy();N=new PX,await N.initialize(X,Z,J)}async function uX(X={}){let{serverUrl:Z,rrweb:J={enable:!1},skipWebSocket:Q=!1}=X,K=Z||"",G=Q||!Z;if(typeof window<"u"){let Y=m();if(G&&window.parent!==window){try{window.parent.postMessage({type:"SET_DEBUG_ID",debugId:Y},"*")}catch{}try{localStorage.setItem("debug_id",Y)}catch{}}}await mX(K,J,G)}async function cX(){if(!N)throw Error("CDP client not initialized / CDP 클라이언트가 초기화되지 않았습니다");let X=N.getDomain();if(!X)throw Error("CDP domain not available / CDP 도메인을 사용할 수 없습니다");let Z=X.getEventStorage();if(!Z)throw Error("Event storage not available / 이벤트 저장소를 사용할 수 없습니다");await Z.exportToFile()}if(typeof window<"u")window.ChromeRemoteDevTools={init:uX,exportEvents:cX};})();
